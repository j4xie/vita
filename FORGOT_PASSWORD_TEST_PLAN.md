# PomeloX忘记密码功能完整测试方案

## 🎯 测试目标
全面验证Web端和App端的忘记密码功能，包括正常流程、错误处理和边缘情况。

## 📋 测试准备

### 测试账号信息
- **测试用户名**: `test_forgot_pwd_2025`
- **邮箱**: `test.forgot@test.com`
- **中国手机号**: `13812345678` (测试用)
- **美国手机号**: `2125551234` (测试用) 
- **初始密码**: `Test123456`

### 测试环境
- **Web端**: http://localhost:8090
- **App端**: iOS模拟器
- **后端API**: https://www.vitaglobal.icu

## 🔄 Web端测试流程

### 1. 正常流程测试
```
步骤1: 访问登录页面
- 打开 http://localhost:8090
- 点击"忘记密码？"按钮

步骤2: 第一个页面 - 验证身份
- 选择区号: 🇨🇳 +86
- 输入手机号: 13812345678
- 点击"发送验证码"
- 等待倒计时显示
- 输入验证码: 123456 (模拟)
- 点击"验证并继续"

步骤3: 第二个页面 - 设置新密码
- 输入新密码: NewTest123
- 确认密码: NewTest123
- 查看密码强度指示器
- 点击"重置密码"

步骤4: 验证结果
- 看到成功提示
- 返回登录页面
- 用新密码登录验证
```

### 2. 美国用户测试
```
步骤1-2: 同上，但选择
- 选择区号: 🇺🇸 +1  
- 输入手机号: 2125551234
- 验证areaCode='US'参数传递
```

### 3. 错误处理测试
```
无效手机号:
- 输入: 123 (太短)
- 输入: 12345678901234 (太长)
- 输入: abc123 (包含字母)

错误验证码:
- 输入: 123 (太短)
- 输入: abcdef (包含字母)
- 输入: 999999 (模拟错误验证码)

密码不匹配:
- 新密码: Test123
- 确认密码: Test456
- 验证错误提示
```

## 📱 App端测试流程

### 1. 正常流程测试
```
步骤1: 启动应用
- 运行: cd frontend && npm run ios
- 等待iOS模拟器启动

步骤2: 导航到忘记密码
- 点击登录页面"忘记密码？"
- 验证页面跳转

步骤3-4: 同Web端流程
- 验证所有功能一致性
- 验证native动画效果
- 验证触觉反馈
```

### 2. 平台差异验证
```
Web端特点:
- 使用WebTextInput组件
- useNativeDriver: false
- 使用WebHaptics

App端特点:
- 使用原生TextInput
- useNativeDriver: true  
- 使用expo-haptics
```

## 🧪 边缘情况测试

### 1. 网络异常测试
```
- 断网情况下发送验证码
- 超时请求处理
- 服务器返回错误状态码
```

### 2. 用户行为测试
```
- 快速多次点击发送按钮
- 倒计时期间切换页面
- 输入验证码时中途退出
- 设置密码时应用后台
```

### 3. 数据验证测试
```
手机号边界测试:
- 中国: 10位数字 ❌
- 中国: 12位数字 ❌
- 中国: 1开头11位 ✅
- 美国: 9位数字 ❌
- 美国: 11位数字 ❌
- 美国: 正确10位格式 ✅

密码强度测试:
- 弱密码: "123456" → 显示红色"弱"
- 中等密码: "test123" → 显示橙色"中等"
- 强密码: "Test123!" → 显示绿色"强"
```

## 🔍 验证要点

### API调用验证
```javascript
// 确认发送验证码API调用
console.log('📱 发送忘记密码验证码:', { 
  phone, 
  areaCode: 'CN' | 'US' 
});

// 确认参数正确传递到后端
const formData = new URLSearchParams();
formData.append('phone', phone);
formData.append('areaCode', areaCode);
```

### 国际化验证
```
中文界面:
- "忘记密码" → "选择地区" → "发送验证码"
- "重置密码" → "设置新密码"

英文界面:
- "Forgot Password" → "Select Region" → "Send Code" 
- "Reset Password" → "Set New Password"
```

### 安全性验证
```
- 验证码只能是6位数字
- 密码必须包含字母+数字，至少6位
- 重置成功后强制返回登录页面
- 敏感信息不在控制台明文显示
```

## 🏁 预期结果

### 成功指标
- ✅ 两个平台功能完全一致
- ✅ 所有表单验证正常工作
- ✅ 错误处理友好且准确
- ✅ 动画和交互流畅
- ✅ 国际化支持完整
- ✅ areaCode参数正确传递

### 失败情况处理
- ❌ 编译错误 → 检查导入和类型定义
- ❌ 导航错误 → 确认路由配置
- ❌ API错误 → 检查接口调用和参数
- ❌ 界面异常 → 验证样式和组件

## 📊 测试报告模板

```markdown
## 忘记密码功能测试报告

### Web端测试结果
- [ ] 页面导航正常
- [ ] 区号选择功能
- [ ] 手机号验证
- [ ] 验证码发送
- [ ] 验证码验证  
- [ ] 新密码设置
- [ ] 成功返回登录

### App端测试结果  
- [ ] 页面导航正常
- [ ] 区号选择功能
- [ ] 手机号验证
- [ ] 验证码发送
- [ ] 验证码验证
- [ ] 新密码设置
- [ ] 成功返回登录

### 边缘情况测试
- [ ] 无效手机号处理
- [ ] 错误验证码处理
- [ ] 密码不匹配处理
- [ ] 网络异常处理

### 跨平台一致性
- [ ] UI界面一致
- [ ] 功能行为一致
- [ ] 错误提示一致
- [ ] 用户体验一致
```