# åç«¯å•†å®¶ä¼šå‘˜å¡åŠŸèƒ½å®ç°éœ€æ±‚æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†æ”¯æŒå¤šå­¦è”ç»„ç»‡æ¶æ„çš„å•†å®¶ä¼šå‘˜å¡ç³»ç»Ÿåç«¯å®ç°éœ€æ±‚ï¼ŒåŒ…æ‹¬ç»„ç»‡ç®¡ç†ã€æƒé™æ§åˆ¶ã€ä¼šå‘˜å¡ç”Ÿæˆå’ŒApple Walleté›†æˆç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ—ï¸ æ•°æ®åº“è®¾è®¡

### 1. ç»„ç»‡è¡¨ (organizations)
```sql
CREATE TABLE organizations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,                    -- ç»„ç»‡åç§°
    display_name_zh VARCHAR(255) NOT NULL,         -- ä¸­æ–‡æ˜¾ç¤ºå
    display_name_en VARCHAR(255) NOT NULL,         -- è‹±æ–‡æ˜¾ç¤ºå
    slug VARCHAR(100) UNIQUE NOT NULL,             -- URLå‹å¥½æ ‡è¯†
    region VARCHAR(100) NOT NULL,                  -- åœ°åŒº (US-NY, US-CA, etc.)
    logo_url VARCHAR(500),                         -- Logoå›¾ç‰‡URL
    brand_colors JSONB NOT NULL DEFAULT '{}',     -- å“ç‰Œè‰²å½©é…ç½®
    contact_info JSONB,                           -- è”ç³»ä¿¡æ¯
    member_count INTEGER DEFAULT 0,               -- æˆå‘˜æ•°é‡
    is_active BOOLEAN DEFAULT true,               -- æ˜¯å¦å¯ç”¨
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç¤ºä¾‹æ•°æ®
INSERT INTO organizations (name, display_name_zh, display_name_en, slug, region, brand_colors) VALUES
('Columbia CSSA', 'å“¥ä¼¦æ¯”äºšå¤§å­¦ä¸­å›½å­¦ç”Ÿå­¦è€…è”è°Šä¼š', 'Columbia Chinese Students and Scholars Association', 'columbia-cssa', 'US-NY', '{"primary": "#1E40AF", "secondary": "#DBEAFE"}'),
('NYU GSU', 'çº½çº¦å¤§å­¦ä¸­å›½å­¦ç”Ÿä¼š', 'NYU Graduate Student Union Chinese Chapter', 'nyu-gsu', 'US-NY', '{"primary": "#7C3AED", "secondary": "#EDE9FE"}');
```

### 2. å•†å®¶è¡¨ (merchants)
```sql
CREATE TABLE merchants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,                    -- å•†å®¶åç§°
    category VARCHAR(100) NOT NULL,               -- ç±»åˆ«: dining, retail, service, education
    description TEXT,                             -- æè¿°
    logo_url VARCHAR(500),                        -- Logo URL
    brand_colors JSONB DEFAULT '{}',              -- å“ç‰Œè‰²å½©
    address TEXT,                                 -- åœ°å€
    phone VARCHAR(50),                            -- ç”µè¯
    website VARCHAR(255),                         -- ç½‘ç«™
    qr_code_pattern VARCHAR(255) UNIQUE,          -- QRç æ¨¡å¼
    business_hours JSONB,                         -- è¥ä¸šæ—¶é—´
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3. ç»„ç»‡-å•†å®¶åˆä½œå…³ç³»è¡¨ (organization_merchant_partnerships)
```sql
CREATE TABLE organization_merchant_partnerships (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,
    merchant_id UUID REFERENCES merchants(id) ON DELETE CASCADE,
    partnership_type VARCHAR(50) DEFAULT 'standard', -- standard, premium, exclusive
    discount_rate DECIMAL(5,2),                      -- æŠ˜æ‰£ç‡
    special_benefits JSONB,                          -- ç‰¹æ®Šæƒç›Š
    start_date DATE,                                 -- åˆä½œå¼€å§‹æ—¥æœŸ
    end_date DATE,                                   -- åˆä½œç»“æŸæ—¥æœŸ
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(organization_id, merchant_id)
);
```

### 4. ç”¨æˆ·ç»„ç»‡å…³ç³»è¡¨ (user_organizations)
```sql
CREATE TABLE user_organizations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,
    membership_level VARCHAR(50) DEFAULT 'basic',    -- basic, premium, vip
    member_number VARCHAR(100),                      -- ä¼šå‘˜ç¼–å·
    join_date DATE DEFAULT CURRENT_DATE,             -- åŠ å…¥æ—¥æœŸ
    is_current BOOLEAN DEFAULT false,                -- å½“å‰æ¿€æ´»ç»„ç»‡
    is_active BOOLEAN DEFAULT true,                  -- ä¼šå‘˜çŠ¶æ€
    verification_status VARCHAR(50) DEFAULT 'pending', -- pending, verified, rejected
    verification_data JSONB,                         -- éªŒè¯ææ–™
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, organization_id)
);
```

### 5. ä¼šå‘˜å¡è¡¨ (membership_cards)
```sql
CREATE TABLE membership_cards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    organization_id UUID REFERENCES organizations(id),  -- ç»„ç»‡ä¼šå‘˜å¡
    merchant_id UUID REFERENCES merchants(id),          -- å•†å®¶ä¼šå‘˜å¡(å¯ä¸ºç©º)
    card_type VARCHAR(50) NOT NULL,                     -- organization, merchant
    card_number VARCHAR(100) UNIQUE NOT NULL,           -- å¡å·
    display_name VARCHAR(255),                          -- æ˜¾ç¤ºåç§°
    points INTEGER DEFAULT 0,                           -- ç§¯åˆ†
    membership_level VARCHAR(50) DEFAULT 'basic',       -- ä¼šå‘˜ç­‰çº§
    qr_code_data TEXT,                                  -- äºŒç»´ç æ•°æ®
    apple_wallet_pass_id VARCHAR(255),                 -- Apple Wallet Pass ID
    google_wallet_object_id VARCHAR(255),              -- Google Wallet Object ID
    last_used_at TIMESTAMP,                            -- æœ€åä½¿ç”¨æ—¶é—´
    expires_at TIMESTAMP,                              -- è¿‡æœŸæ—¶é—´
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_membership_cards_user_id ON membership_cards(user_id);
CREATE INDEX idx_membership_cards_organization_id ON membership_cards(organization_id);
CREATE INDEX idx_membership_cards_merchant_id ON membership_cards(merchant_id);
CREATE INDEX idx_membership_cards_card_number ON membership_cards(card_number);
```

### 6. ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨ (points_transactions)
```sql
CREATE TABLE points_transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    card_id UUID REFERENCES membership_cards(id) ON DELETE CASCADE,
    transaction_type VARCHAR(50) NOT NULL,             -- earn, redeem, transfer, expire
    points_change INTEGER NOT NULL,                    -- ç§¯åˆ†å˜åŒ–(æ­£è´Ÿæ•°)
    description VARCHAR(255),                          -- äº¤æ˜“æè¿°
    reference_id VARCHAR(255),                         -- å…³è”ID(è®¢å•ã€æ´»åŠ¨ç­‰)
    merchant_id UUID REFERENCES merchants(id),         -- ç›¸å…³å•†å®¶
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ”§ API ç«¯ç‚¹è®¾è®¡

### 1. ç»„ç»‡ç®¡ç† API

#### è·å–ç”¨æˆ·å¯ç”¨ç»„ç»‡åˆ—è¡¨
```python
@app.get("/api/organizations/user/{user_id}")
async def get_user_organizations(user_id: str):
    """
    è¿”å›ç”¨æˆ·åŠ å…¥çš„æ‰€æœ‰ç»„ç»‡ï¼ŒåŒ…æ‹¬å½“å‰æ¿€æ´»çŠ¶æ€
    Response:
    {
        "organizations": [
            {
                "id": "uuid",
                "name": "Columbia CSSA",
                "display_name_zh": "å“¥ä¼¦æ¯”äºšå¤§å­¦ä¸­å›½å­¦ç”Ÿå­¦è€…è”è°Šä¼š",
                "display_name_en": "Columbia Chinese Students and Scholars Association",
                "logo_url": "https://...",
                "brand_colors": {"primary": "#1E40AF", "secondary": "#DBEAFE"},
                "membership_level": "basic",
                "is_current": true,
                "member_number": "CSSA2024001"
            }
        ]
    }
    """
```

#### åˆ‡æ¢å½“å‰ç»„ç»‡
```python
@app.post("/api/organizations/switch")
async def switch_organization(request: SwitchOrganizationRequest):
    """
    åˆ‡æ¢ç”¨æˆ·çš„å½“å‰æ¿€æ´»ç»„ç»‡
    Request:
    {
        "user_id": "uuid",
        "organization_id": "uuid"
    }
    Response:
    {
        "success": true,
        "message": "ç»„ç»‡åˆ‡æ¢æˆåŠŸ",
        "current_organization": {...}
    }
    """
```

### 2. å•†å®¶ç®¡ç† API

#### è·å–ç»„ç»‡åˆä½œå•†å®¶åˆ—è¡¨
```python
@app.get("/api/merchants/organization/{organization_id}")
async def get_organization_merchants(organization_id: str, category: str = None):
    """
    è·å–æŒ‡å®šç»„ç»‡çš„åˆä½œå•†å®¶åˆ—è¡¨
    Response:
    {
        "merchants": [
            {
                "id": "uuid",
                "name": "Starbucks Coffee",
                "category": "dining",
                "logo_url": "https://...",
                "brand_colors": {"primary": "#00704A", "secondary": "#FFFFFF"},
                "partnership_info": {
                    "discount_rate": 10.00,
                    "special_benefits": ["å…è´¹å‡æ¯", "ç”Ÿæ—¥ç‰¹é¥®"]
                }
            }
        ]
    }
    """
```

#### éªŒè¯å•†å®¶QRç 
```python
@app.post("/api/merchants/verify-qr")
async def verify_merchant_qr(request: VerifyQRRequest):
    """
    éªŒè¯å•†å®¶QRç å¹¶æ£€æŸ¥ç”¨æˆ·æƒé™
    Request:
    {
        "qr_data": "vitaglobal://merchant/starbucks-001/location/001",
        "user_id": "uuid",
        "organization_id": "uuid"
    }
    Response:
    {
        "valid": true,
        "merchant": {...},
        "has_permission": true,
        "partnership_info": {...}
    }
    """
```

### 3. ä¼šå‘˜å¡ç®¡ç† API

#### è·å–ç”¨æˆ·ä¼šå‘˜å¡åˆ—è¡¨
```python
@app.get("/api/cards/user/{user_id}")
async def get_user_membership_cards(
    user_id: str, 
    organization_id: str = None, 
    card_type: str = None
):
    """
    è·å–ç”¨æˆ·çš„æ‰€æœ‰ä¼šå‘˜å¡ï¼Œæ”¯æŒæŒ‰ç»„ç»‡å’Œç±»å‹ç­›é€‰
    Response:
    {
        "cards": [
            {
                "id": "uuid",
                "card_type": "organization",
                "organization": {...},
                "card_number": "CSSA2024001",
                "points": 1250,
                "membership_level": "basic",
                "qr_code_data": "encoded_data",
                "created_at": "2024-01-01T00:00:00Z"
            },
            {
                "id": "uuid", 
                "card_type": "merchant",
                "merchant": {...},
                "organization": {...},
                "card_number": "SB001234567",
                "points": 480,
                "membership_level": "basic"
            }
        ]
    }
    """
```

#### åˆ›å»ºå•†å®¶ä¼šå‘˜å¡
```python
@app.post("/api/cards/create-merchant-card")
async def create_merchant_card(request: CreateMerchantCardRequest):
    """
    æ‰«ç åˆ›å»ºå•†å®¶ä¼šå‘˜å¡
    Request:
    {
        "user_id": "uuid",
        "organization_id": "uuid", 
        "merchant_id": "uuid",
        "qr_data": "scanned_qr_code_data"
    }
    Response:
    {
        "success": true,
        "card": {
            "id": "uuid",
            "card_number": "generated_number",
            "merchant": {...},
            "qr_code_data": "encoded_card_data"
        },
        "apple_wallet_pass_url": "https://api.vitaglobal.com/passes/uuid.pkpass"
    }
    """
```

#### æ›´æ–°ä¼šå‘˜å¡ç§¯åˆ†
```python
@app.post("/api/cards/{card_id}/points")
async def update_card_points(card_id: str, request: UpdatePointsRequest):
    """
    æ›´æ–°ä¼šå‘˜å¡ç§¯åˆ†ï¼ˆæ¶ˆè´¹ã€å¥–åŠ±ç­‰ï¼‰
    Request:
    {
        "points_change": 50,
        "transaction_type": "earn",
        "description": "æ¶ˆè´¹è·å¾—ç§¯åˆ†",
        "merchant_id": "uuid",
        "reference_id": "order_123"
    }
    """
```

### 4. Apple Wallet é›†æˆ API

#### ç”Ÿæˆ Apple Wallet Pass
```python
@app.post("/api/wallet/generate-pass/{card_id}")
async def generate_apple_wallet_pass(card_id: str):
    """
    ä¸ºæŒ‡å®šä¼šå‘˜å¡ç”ŸæˆApple Wallet Passæ–‡ä»¶
    Response:
    {
        "pass_url": "https://api.vitaglobal.com/passes/uuid.pkpass",
        "expires_at": "2024-12-31T23:59:59Z"
    }
    """
```

#### Pass æ›´æ–°å›è°ƒ
```python
@app.post("/api/wallet/passes/{pass_id}/update")
async def update_pass_callback(pass_id: str, request: PassUpdateRequest):
    """
    Apple Wallet Passæ›´æ–°å›è°ƒå¤„ç†
    å½“ç§¯åˆ†æˆ–ä¼šå‘˜ä¿¡æ¯å˜æ›´æ—¶ï¼Œæ¨é€æ›´æ–°åˆ°ç”¨æˆ·çš„Apple Wallet
    """
```

## ğŸ›¡ï¸ æƒé™æ§åˆ¶é€»è¾‘

### 1. ç»„ç»‡æƒé™éªŒè¯
```python
def verify_organization_access(user_id: str, organization_id: str) -> bool:
    """éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æŒ‡å®šç»„ç»‡"""
    user_org = db.query(UserOrganization).filter(
        UserOrganization.user_id == user_id,
        UserOrganization.organization_id == organization_id,
        UserOrganization.is_active == True,
        UserOrganization.verification_status == 'verified'
    ).first()
    return user_org is not None
```

### 2. å•†å®¶æ‰«ç æƒé™éªŒè¯
```python
def verify_merchant_scan_permission(user_id: str, merchant_id: str) -> tuple[bool, str]:
    """éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰«ææŒ‡å®šå•†å®¶çš„QRç """
    # è·å–ç”¨æˆ·å½“å‰æ¿€æ´»çš„ç»„ç»‡
    current_org = get_user_current_organization(user_id)
    if not current_org:
        return False, "ç”¨æˆ·æœªåŠ å…¥ä»»ä½•ç»„ç»‡"
    
    # æ£€æŸ¥ç»„ç»‡ä¸å•†å®¶çš„åˆä½œå…³ç³»
    partnership = db.query(OrganizationMerchantPartnership).filter(
        OrganizationMerchantPartnership.organization_id == current_org.id,
        OrganizationMerchantPartnership.merchant_id == merchant_id,
        OrganizationMerchantPartnership.is_active == True
    ).first()
    
    if not partnership:
        # è¿”å›å¯é€‰çš„å…¶ä»–ç»„ç»‡
        available_orgs = get_merchant_partner_organizations(merchant_id, user_id)
        return False, f"å½“å‰ç»„ç»‡æ— æƒé™ï¼Œå¯åˆ‡æ¢åˆ°: {[org.name for org in available_orgs]}"
    
    return True, "æƒé™éªŒè¯é€šè¿‡"
```

## ğŸ” PassKit è¯ä¹¦é…ç½®

### 1. è¯ä¹¦æ–‡ä»¶ç»“æ„
```
config/passkit/
â”œâ”€â”€ pass_type_certificates/
â”‚   â”œâ”€â”€ organization_pass.p12      # ç»„ç»‡ä¼šå‘˜å¡è¯ä¹¦
â”‚   â”œâ”€â”€ merchant_pass.p12          # å•†å®¶ä¼šå‘˜å¡è¯ä¹¦
â”‚   â””â”€â”€ passkit_password.txt       # è¯ä¹¦å¯†ç 
â”œâ”€â”€ wwdr_certificate.pem           # Apple WWDRè¯ä¹¦
â””â”€â”€ pass_templates/
    â”œâ”€â”€ organization_pass.json     # ç»„ç»‡å¡æ¨¡æ¿
    â””â”€â”€ merchant_pass.json         # å•†å®¶å¡æ¨¡æ¿
```

### 2. Pass ç”ŸæˆæœåŠ¡
```python
from passkit_generator import PassGenerator

class PassKitService:
    def __init__(self):
        self.wwdr_cert = load_certificate("config/passkit/wwdr_certificate.pem")
        self.pass_cert = load_certificate("config/passkit/pass_type_certificates/")
    
    def generate_organization_pass(self, card: MembershipCard) -> bytes:
        """ç”Ÿæˆç»„ç»‡ä¼šå‘˜å¡Pass"""
        pass_data = {
            "passTypeIdentifier": f"pass.com.vitaglobal.org.{card.organization.slug}",
            "serialNumber": card.card_number,
            "organizationName": card.organization.name,
            "logoText": card.organization.display_name_zh,
            "foregroundColor": card.organization.brand_colors.get("primary", "#000000"),
            "backgroundColor": card.organization.brand_colors.get("secondary", "#FFFFFF"),
            "barcode": {
                "format": "PKBarcodeFormatQR",
                "message": card.qr_code_data,
                "messageEncoding": "iso-8859-1"
            },
            "storeCard": {
                "primaryFields": [
                    {"key": "points", "label": "ç§¯åˆ†", "value": str(card.points)}
                ],
                "secondaryFields": [
                    {"key": "level", "label": "ç­‰çº§", "value": card.membership_level},
                    {"key": "member_number", "label": "ä¼šå‘˜å·", "value": card.card_number}
                ],
                "auxiliaryFields": [
                    {"key": "organization", "label": "ç»„ç»‡", "value": card.organization.display_name_zh}
                ]
            }
        }
        
        return self.generate_pass(pass_data)
    
    def generate_merchant_pass(self, card: MembershipCard) -> bytes:
        """ç”Ÿæˆå•†å®¶ä¼šå‘˜å¡Pass"""
        pass_data = {
            "passTypeIdentifier": f"pass.com.vitaglobal.merchant.{card.merchant.id}",
            "serialNumber": card.card_number,
            "organizationName": card.merchant.name,
            "logoText": card.merchant.name,
            "foregroundColor": card.merchant.brand_colors.get("primary", "#000000"),
            "backgroundColor": card.merchant.brand_colors.get("secondary", "#FFFFFF"),
            "barcode": {
                "format": "PKBarcodeFormatQR",
                "message": card.qr_code_data,
                "messageEncoding": "iso-8859-1"
            },
            "storeCard": {
                "primaryFields": [
                    {"key": "points", "label": "ç§¯åˆ†", "value": str(card.points)}
                ],
                "secondaryFields": [
                    {"key": "level", "label": "ç­‰çº§", "value": card.membership_level},
                    {"key": "merchant", "label": "å•†å®¶", "value": card.merchant.name}
                ],
                "auxiliaryFields": [
                    {"key": "organization", "label": "æ‰€å±ç»„ç»‡", "value": card.organization.display_name_zh}
                ]
            }
        }
        
        return self.generate_pass(pass_data)
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡ä¸åˆ†æ

### 1. ç»„ç»‡ç»Ÿè®¡æ•°æ®
```python
@app.get("/api/analytics/organization/{organization_id}")
async def get_organization_analytics(organization_id: str):
    """
    è·å–ç»„ç»‡çš„ç»Ÿè®¡æ•°æ®
    - æˆå‘˜æ•°é‡å’Œå¢é•¿è¶‹åŠ¿
    - å•†å®¶åˆä½œæ•°é‡
    - ä¼šå‘˜å¡ä½¿ç”¨æƒ…å†µ
    - ç§¯åˆ†å‘æ”¾ç»Ÿè®¡
    """
```

### 2. å•†å®¶ç»Ÿè®¡æ•°æ®
```python
@app.get("/api/analytics/merchant/{merchant_id}")
async def get_merchant_analytics(merchant_id: str):
    """
    è·å–å•†å®¶çš„ç»Ÿè®¡æ•°æ®
    - ä¼šå‘˜å¡å‘æ”¾æ•°é‡
    - ç§¯åˆ†äº¤æ˜“è®°å½•
    - ç”¨æˆ·æ´»è·ƒåº¦
    - ä¸åŒç»„ç»‡çš„ç”¨æˆ·åˆ†å¸ƒ
    """
```

## ğŸ”„ æ•°æ®åŒæ­¥ä¸ç¼“å­˜

### 1. Redis ç¼“å­˜ç­–ç•¥
```python
# ç¼“å­˜é”®è®¾è®¡
user_current_org_key = f"user:{user_id}:current_org"
org_merchants_key = f"org:{organization_id}:merchants"
user_cards_key = f"user:{user_id}:cards"

# ç¼“å­˜è¿‡æœŸæ—¶é—´
CACHE_TTL = {
    "user_current_org": 3600,      # 1å°æ—¶
    "org_merchants": 1800,         # 30åˆ†é’Ÿ
    "user_cards": 900,             # 15åˆ†é’Ÿ
    "merchant_info": 3600          # 1å°æ—¶
}
```

### 2. æ•°æ®ä¸€è‡´æ€§ä¿è¯
```python
async def invalidate_user_cache(user_id: str):
    """ç”¨æˆ·æ•°æ®å˜æ›´æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜"""
    await redis.delete(
        f"user:{user_id}:current_org",
        f"user:{user_id}:cards",
        f"user:{user_id}:organizations"
    )

async def invalidate_organization_cache(organization_id: str):
    """ç»„ç»‡æ•°æ®å˜æ›´æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜"""
    await redis.delete(f"org:{organization_id}:merchants")
```

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒå˜é‡
```bash
# PassKit é…ç½®
PASSKIT_TEAM_IDENTIFIER=ABC123DEF4
PASSKIT_PASS_TYPE_IDENTIFIER=pass.com.vitaglobal
PASSKIT_CERTIFICATE_PATH=/config/passkit/certificates/
PASSKIT_CERTIFICATE_PASSWORD=your_certificate_password

# Apple Developer é…ç½®
APPLE_DEVELOPER_ACCOUNT_ID=your_account_id
APPLE_PUSH_CERT_PATH=/config/passkit/push_cert.pem
APPLE_PUSH_CERT_KEY_PATH=/config/passkit/push_key.pem

# Redis é…ç½®
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=your_redis_password

# æ–‡ä»¶å­˜å‚¨é…ç½®
CLOUDFLARE_R2_BUCKET=vitaglobal-passes
CLOUDFLARE_R2_ACCESS_KEY=your_access_key
CLOUDFLARE_R2_SECRET_KEY=your_secret_key
```

### 2. ä¾èµ–åº“
```txt
# requirements.txt æ–°å¢
passkit-generator==1.2.0
cryptography==41.0.7
redis==5.0.1
boto3==1.34.0  # for S3-compatible storage
qrcode==7.4.2
pillow==10.1.0
```

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### 1. æ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] åˆ›å»ºç»„ç»‡ç›¸å…³è¡¨ç»“æ„
- [ ] åˆ›å»ºä¼šå‘˜å¡ç®¡ç†è¡¨ç»“æ„  
- [ ] åˆ›å»ºç´¢å¼•å’Œçº¦æŸ
- [ ] æ’å…¥åˆå§‹ç»„ç»‡æ•°æ®

### 2. PassKit è¯ä¹¦é…ç½®
- [ ] ç”³è¯·Apple Developerè´¦å·
- [ ] åˆ›å»ºPass Type ID
- [ ] ç”ŸæˆPassè¯ä¹¦æ–‡ä»¶
- [ ] é…ç½®æ¨é€è¯ä¹¦

### 3. API ç«¯ç‚¹å®ç°
- [ ] ç»„ç»‡ç®¡ç†ç›¸å…³API
- [ ] å•†å®¶ç®¡ç†ç›¸å…³API
- [ ] ä¼šå‘˜å¡ç®¡ç†ç›¸å…³API
- [ ] PassKité›†æˆAPI

### 4. æƒé™éªŒè¯ç³»ç»Ÿ
- [ ] å®ç°ç»„ç»‡æƒé™éªŒè¯
- [ ] å®ç°å•†å®¶æ‰«ç æƒé™éªŒè¯
- [ ] å®ç°ä¼šå‘˜å¡æ“ä½œæƒé™éªŒè¯

### 5. ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–
- [ ] é…ç½®Redisç¼“å­˜ç­–ç•¥
- [ ] å®ç°æ•°æ®ä¸€è‡´æ€§ä¿è¯
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

è¿™ä¸ªåç«¯å®ç°æ–¹æ¡ˆå°†ä¸ºå‰ç«¯å¤šå­¦è”ç»„ç»‡æ¶æ„å’Œä¼šå‘˜å¡ç³»ç»Ÿæä¾›å®Œæ•´çš„æ•°æ®æ”¯æŒå’Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚