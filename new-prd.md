l# VitaGlobal Phase 0 产品需求文档 (PRD)

## 项目概述
VitaGlobal 是为海外中国学生组织打造的综合性活动管理和报名平台，包含移动端用户应用、管理后台系统和志愿者管理功能。采用推荐码注册系统，为用户提供便捷的活动参与体验，为管理员提供完善的组织管理工具。

**技术架构:**
- **前端移动应用:** React Native + Expo
- **管理后台:** 基于开源框架的Web管理系统  
- **后端服务:** FastAPI + PostgreSQL + Redis
- **开发重点:** 全栈实现，移动端优先，管理功能完备

---

## 移动端用户功能需求

### 1. 用户注册系统

#### 1.1 推荐码注册流程
- **入口:** 注册界面的"推荐码注册"按钮
- **二维码扫描:** 
  - 点击推荐码注册后启动扫码功能
  - 扫描线下/线上提供的推荐码二维码
  - 扫描成功后自动跳转到注册表单页面

#### 1.2 注册表单字段
**必填信息:**
- 法定名（Full Legal Name）
- 英文昵称（English Nickname）
- 所属学校（University）
- 学校邮箱（University Email）- 作为登录账号
- 账户密码（Password）

**电话信息（二选一）:**
- 中国电话号码
- 美国电话号码
- 注：两个电话号码中至少填写一个，另一个为可选

#### 1.3 注册验证
- 使用短信验证码进行电话号码验证
- 推荐码由后端开发提供和验证

### 2. 用户登录系统

#### 2.1 登录方式
- **登录账号:** 使用学校邮箱
- **登录密码:** 用户设置的密码
- **登录状态:** 保持30天，不受网络环境变化影响

#### 2.2 忘记密码功能
- **当前阶段:** 点击后显示"功能尚未实现"
- **后期扩展:** 通过邮箱重置密码

### 3. 活动展示系统

#### 3.1 应用启动流程
- **默认页面:** 活动列表页（非登录页）
- **登录检查:** 在用户操作需要登录时再进行验证

#### 3.2 活动列表设计
**UI风格:**
- 参考Popping软件的布局结构
- 配色更加阳光明亮，传达积极正面的氛围

**活动卡片组件:**
- 活动照片（主图片，占卡片主要面积）
- 活动名称（大字体，醒目显示）
- 活动地点（小字体，简洁信息）

#### 3.3 活动详情页面
- 活动详细信息展示
- 活动图片展示
- 活动描述和要求
- 活动报名入口按钮

### 4. 活动报名系统

#### 4.1 报名权限控制
- **未登录用户:** 点击报名按钮后自动跳转到登录页面
- **已登录用户:** 直接进入报名流程

#### 4.2 动态报名表单
**表单特性:**
- 后端根据不同活动类型配置不同的表单模板
- 支持多种表单字段类型：文本输入、选择项、勾选框等

**用户信息自动填充:**
- 自动读取并显示已登录用户的基本信息
- 基本信息显示但不可编辑，确保数据一致性
- 用户可以看到自己的注册信息用于确认

**补充信息:**
- 根据活动需要填写额外的信息
- 选择项和勾选框配置
- 特殊要求或备注信息

#### 4.3 报名确认和核销
**报名成功流程:**
1. 用户提交报名表单
2. 系统生成唯一的报名二维码
3. 显示二维码确认页面
4. 二维码用于现场活动核销

### 5. 扫码功能

#### 5.1 扫码入口
- **位置:** 主界面右上角
- **图标:** 扫码图标，清晰可见

#### 5.2 扫码功能
- 推荐码二维码扫描（注册时使用）
- 活动核销二维码扫描
- 其他功能扩展的二维码支持

---

## 用户体验流程

### 主流程图
```
应用启动 → 活动列表页 → 选择活动 → 活动详情
                                    ↓
登录验证 ← 点击报名 ← 活动报名入口
    ↓
注册流程 ← 新用户
    ↓
推荐码扫描 → 填写注册信息 → 短信验证 → 注册成功 → 自动登录
    ↓
活动报名表单 → 填写信息 → 提交报名 → 生成二维码 → 核销确认
```

### 注册详细流程
```
点击注册 → 选择推荐码注册 → 扫描二维码 → 跳转注册表单
                                        ↓
填写法定名 → 英文昵称 → 学校 → 邮箱 → 密码 → 选择电话类型
                                        ↓
填写电话号码 → 发送验证码 → 输入验证码 → 注册成功 → 自动登录
```

---

## 技术实现要点

### UI/UX设计
- **整体风格:** 阳光、积极、现代化
- **主色调:** 明亮温暖的色彩搭配
- **交互设计:** 流畅自然，减少用户操作步骤
- **响应式:** 适配不同尺寸的移动设备

### 核心技术栈
- **二维码处理:** expo-barcode-scanner (扫描) + react-native-qrcode-svg (生成)
- **状态管理:** Context API 或 Redux Toolkit
- **数据持久化:** AsyncStorage (用户登录状态)
- **表单处理:** React Hook Form
- **网络请求:** Axios + 请求拦截器
- **导航管理:** React Navigation

### 数据管理
- **登录状态:** 本地持久化存储，30天有效期
- **用户信息:** 全局状态管理，登录后缓存
- **活动数据:** 接口获取，支持缓存机制
- **表单配置:** 动态从后端获取表单模板

---

## 开发优先级

### Phase 1 - 基础架构
- [x] 项目初始化和基础配置
- [ ] UI组件库搭建
- [ ] 导航系统配置
- [ ] 网络请求层封装

### Phase 2 - 活动展示
- [ ] 活动列表页面
- [ ] 活动卡片组件
- [ ] 活动详情页面
- [ ] 图片加载和缓存

### Phase 3 - 用户系统
- [ ] 登录页面
- [ ] 注册页面
- [ ] 二维码扫描功能
- [ ] 用户状态管理

### Phase 4 - 报名功能
- [ ] 动态表单组件
- [ ] 报名流程实现
- [ ] 二维码生成和显示
- [ ] 权限控制实现

### Phase 5 - 完善优化
- [ ] 错误处理和用户反馈
- [ ] 性能优化
- [ ] 测试和调试
- [ ] 应用发布准备

---

## 验收标准

### 功能验收
- ✅ 用户可以通过推荐码扫码注册
- ✅ 用户可以使用邮箱密码登录，状态保持30天
- ✅ 应用启动默认显示活动列表
- ✅ 活动卡片显示清晰，支持点击查看详情
- ✅ 未登录用户报名时自动跳转登录
- ✅ 登录用户可以成功报名并获得二维码
- ✅ 主界面右上角扫码功能正常工作

### 体验验收
- ✅ 界面美观，配色阳光积极
- ✅ 操作流程简单直观
- ✅ 响应速度快，加载流畅
- ✅ 错误提示友好，引导明确

### 技术验收
- ✅ 代码结构清晰，可维护性好
- ✅ 组件复用性强，扩展性好
- ✅ 网络异常处理完善
- ✅ 数据安全存储，用户隐私保护

---

## 管理服务端功能需求

### 概述
管理服务端采用开源框架搭建，为VitaGlobal平台提供完整的后台管理功能。该系统主要用于系统管理员和组织管理员进行平台运营和用户管理。

### 6. 系统管理功能模块

#### 6.1 用户管理
**功能描述:** 管理系统操作者账号和权限
- **用户配置:** 创建、编辑、删除系统用户账号
- **角色分配:** 为用户分配不同的系统角色
- **权限控制:** 设置用户的功能访问权限
- **账号状态:** 启用、禁用、锁定用户账号
- **登录日志:** 追踪用户登录行为和异常

#### 6.2 部门管理
**功能描述:** 组织机构的层级化管理
- **组织结构:** 支持公司、部门、小组的树形结构展现
- **数据权限:** 按部门设置数据访问范围
- **层级管理:** 支持多级部门嵌套和权限继承
- **人员关系:** 管理用户与部门的归属关系

#### 6.3 岗位管理
**功能描述:** 系统用户职务和职责配置
- **岗位定义:** 创建和配置系统中的各种职务
- **职责描述:** 定义每个岗位的权限范围和职责
- **用户分配:** 为用户分配相应的岗位角色

#### 6.4 菜单管理
**功能描述:** 系统菜单和功能权限控制
- **菜单配置:** 动态配置系统菜单结构
- **操作权限:** 设置页面和功能的访问权限
- **按钮权限:** 细粒度的按钮级别权限控制
- **权限标识:** 统一的权限标识符管理

#### 6.5 角色管理
**功能描述:** 基于角色的权限管理系统
- **角色定义:** 创建和管理系统角色
- **菜单权限:** 为角色分配菜单访问权限
- **数据范围:** 按机构设置角色的数据权限范围
- **权限模板:** 预设常用角色权限模板

### 7. 系统运维功能

#### 7.1 字典管理
**功能描述:** 系统常用固定数据维护
- **数据字典:** 管理系统中的枚举值和选项
- **分类管理:** 按业务分类组织字典数据
- **动态配置:** 支持运行时动态修改字典值

#### 7.2 参数管理
**功能描述:** 系统动态参数配置
- **系统参数:** 配置系统运行参数
- **业务参数:** 动态调整业务逻辑参数
- **环境配置:** 不同环境的参数差异化管理

#### 7.3 通知公告
**功能描述:** 系统消息和公告发布
- **公告发布:** 发布系统通知和重要公告
- **消息推送:** 向指定用户或用户组推送消息
- **公告管理:** 公告的创建、编辑、发布、撤回

#### 7.4 操作日志
**功能描述:** 系统操作行为记录和审计
- **操作记录:** 记录用户的所有操作行为
- **异常日志:** 记录和查询系统异常信息
- **日志分析:** 提供操作行为的统计分析
- **审计追踪:** 支持操作行为的完整追溯

#### 7.5 登录日志
**功能描述:** 用户登录行为监控
- **登录记录:** 记录所有用户登录行为
- **异常监控:** 识别和记录异常登录行为
- **统计分析:** 用户登录情况的统计报表

### 8. 系统监控功能

#### 8.1 在线用户
**功能描述:** 当前活跃用户状态监控
- **用户列表:** 实时显示在线用户信息
- **会话管理:** 管理用户会话状态
- **强制下线:** 可强制指定用户下线

#### 8.2 定时任务
**功能描述:** 系统计划任务管理
- **任务配置:** 在线添加、修改、删除定时任务
- **执行监控:** 监控任务执行状态和结果
- **执行日志:** 记录任务执行历史和结果日志
- **任务调度:** 支持Cron表达式的灵活调度

#### 8.3 系统接口
**功能描述:** API接口文档和管理
- **接口文档:** 根据业务代码自动生成API文档
- **接口测试:** 提供在线接口测试功能
- **接口监控:** 监控接口调用情况和性能

#### 8.4 服务监控
**功能描述:** 系统资源使用情况监控
- **系统资源:** 监视CPU、内存、磁盘使用情况
- **堆栈信息:** 监控应用堆栈状态
- **性能指标:** 提供系统性能相关指标
- **告警功能:** 资源使用异常时的告警通知

#### 8.5 缓存监控
**功能描述:** 系统缓存管理和监控
- **缓存查询:** 查看缓存中的数据内容
- **缓存操作:** 支持缓存的删除和清空操作
- **缓存统计:** 缓存使用情况统计分析
- **性能优化:** 基于缓存数据进行性能调优

### 9. 开发工具功能

#### 9.1 代码生成
**功能描述:** 自动化代码生成工具
- **代码模板:** 支持Java、HTML、XML、SQL代码生成
- **CRUD生成:** 自动生成基础增删改查功能代码
- **代码下载:** 生成的代码支持打包下载
- **模板定制:** 支持自定义代码生成模板

#### 9.2 在线构建器
**功能描述:** 可视化表单设计工具
- **拖拽设计:** 拖动表单元素设计表单布局
- **HTML生成:** 自动生成对应的HTML代码
- **组件库:** 丰富的表单组件库支持
- **预览功能:** 实时预览表单设计效果

#### 9.3 连接池监视
**功能描述:** 数据库连接池状态监控
- **连接池状态:** 监视数据库连接池当前状态
- **性能分析:** 分析SQL执行性能
- **瓶颈识别:** 找出系统性能瓶颈
- **优化建议:** 提供数据库优化建议

---

## 移动端志愿者管理功能

### 10. 志愿者签到系统

#### 10.1 管理员签到页面
**功能描述:** 管理员专用的志愿者签到管理界面
- **入口位置:** 管理员账号登录后在主菜单显示"志愿者管理"选项
- **页面布局:** 简洁的查询界面和操作按钮区域
- **快速查询:** 支持手机号快速搜索功能
- **批量操作:** 支持批量签到和签出操作

#### 10.2 用户查询功能
**功能描述:** 基于手机号的用户状态查询
- **查询方式:** 输入或扫描识别手机号码
- **信息显示:**
  - 用户基本信息（姓名、学校、联系方式）
  - 当前签到状态（已签到/未签到）
  - 签到时间记录
  - 累计志愿时长
- **历史记录:** 显示用户历史活动参与记录

#### 10.3 签到/签出流程
**功能描述:** 志愿者工时记录的完整流程

**签到流程:**
1. 管理员输入参与者手机号
2. 系统查询用户注册信息
3. 显示用户基本信息和签到状态
4. 如未签到，显示"签到"按钮
5. 点击签到后记录开始时间
6. 更新用户状态为"已签到"

**签出流程:**
1. 查询已签到用户信息
2. 显示已签到时长（实时更新）
3. 显示"签出"按钮
4. 点击签出后记录结束时间
5. 计算本次志愿时长
6. 累加到用户总志愿时长
7. 更新状态为"已签出"

#### 10.4 时间记录系统
**功能描述:** 精确的志愿服务时间统计

**时间计算规则:**
- 精确到分钟级别的时间记录
- 自动计算签到签出时间差
- 支持跨日期的长时间志愿服务
- 异常情况处理（忘记签出等）

**累计统计:**
- 单次活动志愿时长记录
- 用户总计志愿时长统计
- 按活动分类的时长统计
- 按时间段的志愿时长统计

#### 10.5 证书和奖项支持
**功能描述:** 为证书颁发和奖项申请提供数据支持

**数据记录:**
- 详细的志愿服务记录
- 服务时长的官方认证数据
- 活动类型和服务内容分类
- 服务质量评估记录

**报告生成:**
- 个人志愿服务报告
- 组织志愿服务统计报告
- 符合总统奖申请要求的时长证明
- 可导出的官方格式证书数据

#### 10.6 异常处理机制
**功能描述:** 处理各种异常情况

**异常情况处理:**
- 忘记签出的自动提醒和手动处理
- 重复签到的防护机制
- 异常时长的标记和审核
- 数据错误的修正流程

**管理员权限:**
- 手动修正签到签出时间
- 删除错误的签到记录
- 补录遗漏的志愿时长
- 导出时长数据进行审核

---

## 项目时间线更新

### 11. 关键时间节点

#### 11.1 开发阶段时间线
```
Phase 1: 核心功能开发 (即日起 - 8月20日)
├── 后端开发完成
│   ├── 用户管理系统
│   ├── 活动管理系统  
│   ├── 志愿者签到API
│   └── 管理后台API
└── 前端开发完成
    ├── 移动端用户功能
    ├── 志愿者签到页面
    └── 管理后台界面
```

#### 11.2 系统集成阶段 (8月21日 - 8月31日)
```
Phase 2: 系统集成和测试
├── 前后端接口对接
├── 第三方服务集成测试
├── 用户体验测试和优化
└── 系统性能测试和调优
```

#### 11.3 部署上线阶段 (9月1日 - 9月11日)
```
Phase 3: 部署和发布
├── 9月1日前：完成系统上线
│   ├── 服务器部署配置
│   ├── 域名和SSL证书配置
│   ├── 苹果开发者账户申请
│   └── App Store Connect配置
├── 9月6日前：完成App审核提交
│   ├── App Store审核提交
│   ├── Google Play审核提交
│   └── 审核问题处理和修正
└── 9月11日前：最终版本上线
    ├── App Store正式发布
    ├── 用户使用培训
    └── 技术支持准备就绪
```

### 12. 基础设施准备

#### 12.1 已完成项目
- ✅ **域名购买:** 项目域名已购买完成
- ✅ **服务器采购:** 生产服务器已准备就绪
- ✅ **第三方服务配置:** Gmail、Cloudflare R2、Firebase等服务85%完成

#### 12.2 待完成项目
```
关键待办事项 (紧急)：

1. 服务器备案 (需要App软件名称)
   - 准备备案材料
   - 提交备案申请
   - 配合备案审核流程
   - 预计时长：5-7个工作日

2. 苹果开发者账户申请
   - 企业开发者账户申请
   - 开发者协议签署
   - 支付年费和身份验证
   - 预计时长：1-3个工作日

3. 应用商店资料准备
   - App图标和启动画面设计
   - 应用商店截图制作
   - 应用描述和关键词优化
   - 隐私政策和用户协议制定
```

### 13. 风险控制和应急预案

#### 13.1 时间风险应对
- **备用方案:** 功能优先级排序，确保核心功能按时完成
- **并行开发:** 前后端开发、测试、部署流程并行进行
- **提前准备:** 应用商店审核资料提前准备，避免审核延迟

#### 13.2 技术风险应对
- **备用服务:** 关键第三方服务准备备用方案
- **性能优化:** 提前进行压力测试，确保系统稳定性
- **数据备份:** 完整的数据备份和恢复方案

---

## 后续扩展规划

### 短期功能
- 忘记密码功能实现
- 用户个人中心完善
- 活动收藏功能
- 志愿者证书自动生成

### 中期功能
- 推送通知优化
- 活动分类筛选增强
- 社交分享功能
- 多组织管理支持

### 长期功能
- 活动评价系统
- 用户积分奖励
- 社区互动功能
- 数据分析和智能推荐

---

**文档版本:** v2.0  
**创建时间:** 2025年8月9日  
**最后更新:** 2025年8月10日  
**维护人员:** 产品开发团队