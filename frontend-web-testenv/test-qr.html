<!DOCTYPE html>
<html>
<head>
    <title>QR Scanner Test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <h1>QR Scanner æµ‹è¯•</h1>
    <div id="status">å‡†å¤‡ä¸­...</div>
    <video id="preview" style="width: 100%; max-width: 400px; height: 300px; border: 1px solid #ccc;"></video>
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
        æ‰«æç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
    <script>
        const video = document.getElementById('preview');
        const status = document.getElementById('status');
        const result = document.getElementById('result');

        console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–QRæ‰«æå™¨æµ‹è¯•');

        async function startScanner() {
            try {
                status.textContent = 'æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´...';
                
                // è·å–æ‘„åƒå¤´
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                video.srcObject = stream;
                await video.play();
                
                status.textContent = 'æ‘„åƒå¤´å·²å¯åŠ¨ï¼Œåˆ›å»ºæ‰«æå™¨...';
                console.log('ğŸ“¹ æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ');

                // åˆ›å»ºQRæ‰«æå™¨
                const scanner = new QrScanner(
                    video,
                    (scanResult) => {
                        console.log('ğŸ¯ æ‰«æåˆ°QRç :', scanResult.data);
                        result.innerHTML = `
                            <strong>æ‰«ææˆåŠŸï¼</strong><br>
                            å†…å®¹: ${scanResult.data}<br>
                            æ—¶é—´: ${new Date().toLocaleTimeString()}
                        `;
                        result.style.background = '#d4edda';
                        result.style.color = '#155724';
                        
                        // æ’­æ”¾ä¸€ä¸ªç®€å•çš„æç¤ºéŸ³
                        try {
                            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+P0t2MbBzSt3/C9dSsBLGem8N2QQQoUXrTp66hVFApGn+P0t2MbBziR1/LNeSsFJHfI8N2QQAoUXrTp66hVFApGn+P0t2MbBjiR1/LNeSsFJHfI8N2QQAoUXrTp66hVFApGn+P0t2MbBTiR1/LNeSsFJHfI8N2QQAoUXrTp66hVFApGn+P0t2M');
                            audio.play().catch(() => {});
                        } catch (e) {}
                    },
                    {
                        highlightScanRegion: true,
                        highlightCodeOutline: true,
                        maxScansPerSecond: 10
                    }
                );

                await scanner.start();
                status.textContent = 'æ‰«æå™¨å·²å¯åŠ¨ï¼è¯·æ‰«æäºŒç»´ç ';
                console.log('âœ… QRæ‰«æå™¨å¯åŠ¨æˆåŠŸ');

            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
                status.textContent = 'é”™è¯¯: ' + error.message;
                result.innerHTML = 'å¯åŠ¨å¤±è´¥: ' + error.message;
                result.style.background = '#f8d7da';
                result.style.color = '#721c24';
            }
        }

        // é¡µé¢åŠ è½½åå¯åŠ¨
        window.addEventListener('load', startScanner);
    </script>
</body>
</html>