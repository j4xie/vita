<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PomeloX 网页端实时监控面板</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .header .status {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .card h3 {
      font-size: 1.4rem;
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .icon {
      font-size: 1.5rem;
    }
    
    .metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }
    
    .metric:last-child {
      border-bottom: none;
    }
    
    .metric-label {
      font-weight: 500;
      color: #666;
    }
    
    .metric-value {
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    .status-good { color: #4CAF50; }
    .status-warning { color: #FF9800; }
    .status-error { color: #F44336; }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #f0f0f0;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    .progress-good { background: linear-gradient(90deg, #4CAF50, #81C784); }
    .progress-warning { background: linear-gradient(90deg, #FF9800, #FFB74D); }
    .progress-error { background: linear-gradient(90deg, #F44336, #E57373); }
    
    .log-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      max-height: 500px;
      overflow-y: auto;
    }
    
    .log-entry {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9rem;
      border-left: 4px solid;
    }
    
    .log-error {
      background: #ffebee;
      border-left-color: #f44336;
    }
    
    .log-warning {
      background: #fff3e0;
      border-left-color: #ff9800;
    }
    
    .log-info {
      background: #e3f2fd;
      border-left-color: #2196f3;
    }
    
    .log-success {
      background: #e8f5e8;
      border-left-color: #4caf50;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-secondary {
      background: linear-gradient(45deg, #95a5a6, #7f8c8d);
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #e74c3c, #c0392b);
    }
    
    .chart-container {
      height: 200px;
      display: flex;
      align-items: end;
      justify-content: space-around;
      padding: 20px 0;
      background: linear-gradient(to top, rgba(0,0,0,0.05), transparent);
      border-radius: 10px;
      margin-top: 15px;
    }
    
    .chart-bar {
      width: 20px;
      background: linear-gradient(to top, #667eea, #764ba2);
      border-radius: 10px 10px 0 0;
      transition: height 0.3s ease;
      position: relative;
    }
    
    .chart-label {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      color: #666;
    }
    
    .timestamp {
      color: #999;
      font-size: 0.85rem;
      margin-bottom: 5px;
    }
    
    @media (max-width: 768px) {
      .dashboard {
        padding: 10px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .controls {
        justify-content: center;
      }
      
      .card {
        padding: 20px;
      }
    }
    
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .alert.show {
      transform: translateX(0);
    }
    
    .alert-success {
      background: linear-gradient(45deg, #4CAF50, #81C784);
    }
    
    .alert-error {
      background: linear-gradient(45deg, #F44336, #E57373);
    }
    
    .alert-warning {
      background: linear-gradient(45deg, #FF9800, #FFB74D);
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>🎭 PomeloX 网页端监控面板</h1>
      <div class="status">
        <span id="connection-status">🔴 离线</span> | 
        <span id="last-update">最后更新: 从未</span>
      </div>
    </div>

    <div class="controls">
      <button class="btn" onclick="startMonitoring()">🚀 开始监控</button>
      <button class="btn btn-secondary" onclick="pauseMonitoring()">⏸️ 暂停监控</button>
      <button class="btn btn-danger" onclick="clearLogs()">🗑️ 清除日志</button>
      <button class="btn" onclick="exportData()">📊 导出数据</button>
      <button class="btn" onclick="runTests()">🧪 运行测试</button>
    </div>

    <div class="grid">
      <!-- 实时状态概览 -->
      <div class="card">
        <h3><span class="icon">📊</span> 实时状态</h3>
        <div class="metric">
          <span class="metric-label">监控状态</span>
          <span class="metric-value" id="monitoring-status">待启动</span>
        </div>
        <div class="metric">
          <span class="metric-label">会话时长</span>
          <span class="metric-value" id="session-duration">00:00:00</span>
        </div>
        <div class="metric">
          <span class="metric-label">页面URL</span>
          <span class="metric-value" id="current-url">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">最后检查</span>
          <span class="metric-value" id="last-check">从未</span>
        </div>
      </div>

      <!-- 性能指标 -->
      <div class="card">
        <h3><span class="icon">⚡</span> 性能指标</h3>
        <div class="metric">
          <span class="metric-label">页面加载时间</span>
          <span class="metric-value status-good" id="page-load-time">-</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill progress-good" id="load-time-bar" style="width: 0%"></div>
        </div>
        <div class="metric">
          <span class="metric-label">首次内容绘制</span>
          <span class="metric-value" id="fcp-time">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">内存使用</span>
          <span class="metric-value" id="memory-usage">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">性能评分</span>
          <span class="metric-value status-good" id="performance-score">- / 100</span>
        </div>
      </div>

      <!-- 错误统计 -->
      <div class="card">
        <h3><span class="icon">🚨</span> 错误统计</h3>
        <div class="metric">
          <span class="metric-label">JavaScript 错误</span>
          <span class="metric-value status-error" id="js-errors">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">网络错误</span>
          <span class="metric-value status-error" id="network-errors">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">控制台警告</span>
          <span class="metric-value status-warning" id="console-warnings">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">总错误数</span>
          <span class="metric-value" id="total-errors">0</span>
        </div>
      </div>

      <!-- 网络活动 -->
      <div class="card">
        <h3><span class="icon">🌐</span> 网络活动</h3>
        <div class="metric">
          <span class="metric-label">总请求数</span>
          <span class="metric-value" id="total-requests">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">失败请求</span>
          <span class="metric-value status-error" id="failed-requests">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">平均响应时间</span>
          <span class="metric-value" id="avg-response-time">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">传输总量</span>
          <span class="metric-value" id="total-transfer">-</span>
        </div>
      </div>

      <!-- 用户体验指标 -->
      <div class="card">
        <h3><span class="icon">👤</span> 用户体验</h3>
        <div class="metric">
          <span class="metric-label">交互响应时间</span>
          <span class="metric-value" id="interaction-time">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">页面稳定性</span>
          <span class="metric-value status-good" id="page-stability">优秀</span>
        </div>
        <div class="metric">
          <span class="metric-label">可访问性评分</span>
          <span class="metric-value" id="accessibility-score">- / 100</span>
        </div>
        <div class="metric">
          <span class="metric-label">移动端兼容</span>
          <span class="metric-value status-good" id="mobile-compatibility">良好</span>
        </div>
      </div>

      <!-- 测试结果 -->
      <div class="card">
        <h3><span class="icon">🧪</span> 测试结果</h3>
        <div class="metric">
          <span class="metric-label">通过测试</span>
          <span class="metric-value status-good" id="tests-passed">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">失败测试</span>
          <span class="metric-value status-error" id="tests-failed">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">总测试数</span>
          <span class="metric-value" id="tests-total">0</span>
        </div>
        <div class="metric">
          <span class="metric-label">测试覆盖率</span>
          <span class="metric-value" id="test-coverage">- %</span>
        </div>
      </div>
    </div>

    <!-- 性能趋势图 -->
    <div class="card" style="margin-bottom: 20px;">
      <h3><span class="icon">📈</span> 性能趋势</h3>
      <div class="chart-container" id="performance-chart">
        <!-- 动态生成的图表柱状图 -->
      </div>
    </div>

    <!-- 实时日志 -->
    <div class="log-container">
      <h3><span class="icon">📋</span> 实时监控日志</h3>
      <div id="log-entries">
        <div class="log-entry log-info">
          <div class="timestamp">2025-09-06 15:30:00</div>
          <div>🎭 PomeloX 监控面板已初始化，等待开始监控...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 消息提示 -->
  <div id="alert" class="alert"></div>

  <script>
    // 监控状态管理
    class MonitoringDashboard {
      constructor() {
        this.isMonitoring = false;
        this.sessionStart = null;
        this.metrics = {
          performance: [],
          errors: [],
          requests: [],
          tests: []
        };
        this.updateInterval = null;
        
        this.initializeEventListeners();
        this.initializeChart();
      }
      
      initializeEventListeners() {
        // 定期更新显示
        setInterval(() => this.updateSessionTime(), 1000);
        
        // 模拟数据更新（实际项目中会连接到 Playwright 测试）
        setInterval(() => {
          if (this.isMonitoring) {
            this.updateMetrics();
          }
        }, 5000);
      }
      
      initializeChart() {
        const chartContainer = document.getElementById('performance-chart');
        for (let i = 0; i < 10; i++) {
          const bar = document.createElement('div');
          bar.className = 'chart-bar';
          bar.innerHTML = `<div class="chart-label">${i + 1}</div>`;
          bar.style.height = '20px';
          chartContainer.appendChild(bar);
        }
      }
      
      startMonitoring() {
        this.isMonitoring = true;
        this.sessionStart = new Date();
        
        this.updateStatus('监控中', 'status-good');
        this.updateConnectionStatus('🟢 在线');
        this.log('🚀 监控已启动', 'success');
        this.showAlert('监控已启动', 'success');
        
        // 模拟页面加载
        setTimeout(() => {
          this.updateMetric('current-url', window.location.href);
          this.updateMetric('page-load-time', '1.2s');
          this.updateProgressBar('load-time-bar', 30, 'good');
          this.log('📊 性能数据收集中...', 'info');
        }, 1000);
        
        // 启动测试
        setTimeout(() => this.simulateTests(), 2000);
      }
      
      pauseMonitoring() {
        this.isMonitoring = false;
        this.updateStatus('已暂停', 'status-warning');
        this.log('⏸️ 监控已暂停', 'warning');
        this.showAlert('监控已暂停', 'warning');
      }
      
      clearLogs() {
        const logContainer = document.getElementById('log-entries');
        logContainer.innerHTML = '';
        this.log('🗑️ 日志已清除', 'info');
        this.showAlert('日志已清除', 'success');
      }
      
      exportData() {
        const data = {
          session: {
            start: this.sessionStart,
            duration: this.getSessionDuration(),
            status: this.isMonitoring ? 'active' : 'paused'
          },
          metrics: this.metrics,
          timestamp: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `pomelox-monitoring-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        this.log('📊 监控数据已导出', 'success');
        this.showAlert('数据导出成功', 'success');
      }
      
      runTests() {
        this.log('🧪 开始运行自动化测试...', 'info');
        this.showAlert('开始运行测试...', 'success');
        
        // 模拟测试运行
        let testsRun = 0;
        const totalTests = 15;
        
        const testInterval = setInterval(() => {
          testsRun++;
          
          const passed = Math.random() > 0.1; // 90% 通过率
          const testName = this.getRandomTestName();
          
          if (passed) {
            this.log(`✅ 测试通过: ${testName}`, 'success');
            this.updateMetric('tests-passed', parseInt(document.getElementById('tests-passed').textContent) + 1);
          } else {
            this.log(`❌ 测试失败: ${testName}`, 'error');
            this.updateMetric('tests-failed', parseInt(document.getElementById('tests-failed').textContent) + 1);
          }
          
          this.updateMetric('tests-total', testsRun);
          
          if (testsRun >= totalTests) {
            clearInterval(testInterval);
            const passRate = (parseInt(document.getElementById('tests-passed').textContent) / totalTests * 100).toFixed(1);
            this.updateMetric('test-coverage', `${passRate}%`);
            this.log(`🎯 测试完成，通过率: ${passRate}%`, 'success');
            this.showAlert('测试运行完成', 'success');
          }
        }, 500);
      }
      
      updateMetrics() {
        // 模拟实时指标更新
        const performanceScore = Math.floor(Math.random() * 30) + 70; // 70-100
        this.updateMetric('performance-score', `${performanceScore} / 100`);
        
        const memoryUsage = (Math.random() * 50 + 20).toFixed(1); // 20-70 MB
        this.updateMetric('memory-usage', `${memoryUsage} MB`);
        
        const requests = Math.floor(Math.random() * 5) + parseInt(document.getElementById('total-requests').textContent || '0');
        this.updateMetric('total-requests', requests);
        
        const avgResponse = (Math.random() * 500 + 200).toFixed(0); // 200-700ms
        this.updateMetric('avg-response-time', `${avgResponse}ms`);
        
        // 更新性能图表
        this.updatePerformanceChart(performanceScore);
        
        // 随机错误
        if (Math.random() < 0.1) { // 10% 概率产生错误
          const errorType = Math.random() < 0.5 ? 'js-errors' : 'network-errors';
          const currentErrors = parseInt(document.getElementById(errorType).textContent);
          this.updateMetric(errorType, currentErrors + 1);
          this.updateTotalErrors();
          
          const errorMsg = errorType === 'js-errors' ? '发现 JavaScript 错误' : '检测到网络请求失败';
          this.log(`🚨 ${errorMsg}`, 'error');
        }
        
        this.updateMetric('last-check', new Date().toLocaleTimeString());
      }
      
      updatePerformanceChart(score) {
        const bars = document.querySelectorAll('.chart-bar');
        const height = Math.max(20, (score / 100) * 180);
        const randomBar = bars[Math.floor(Math.random() * bars.length)];
        randomBar.style.height = `${height}px`;
      }
      
      simulateTests() {
        // 模拟一些基础测试
        const tests = [
          '页面加载测试',
          '响应式设计测试',
          '用户交互测试',
          'API连接测试',
          '性能基准测试'
        ];
        
        tests.forEach((test, index) => {
          setTimeout(() => {
            this.log(`🧪 执行测试: ${test}`, 'info');
            
            setTimeout(() => {
              const passed = Math.random() > 0.2; // 80% 通过率
              if (passed) {
                this.log(`✅ ${test} - 通过`, 'success');
              } else {
                this.log(`❌ ${test} - 失败`, 'error');
              }
            }, 1000);
          }, index * 2000);
        });
      }
      
      updateStatus(status, className) {
        const element = document.getElementById('monitoring-status');
        element.textContent = status;
        element.className = `metric-value ${className}`;
      }
      
      updateConnectionStatus(status) {
        document.getElementById('connection-status').textContent = status;
        document.getElementById('last-update').textContent = `最后更新: ${new Date().toLocaleTimeString()}`;
      }
      
      updateMetric(id, value) {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = value;
        }
      }
      
      updateProgressBar(id, percentage, type) {
        const bar = document.getElementById(id);
        if (bar) {
          bar.style.width = `${percentage}%`;
          bar.className = `progress-fill progress-${type}`;
        }
      }
      
      updateTotalErrors() {
        const jsErrors = parseInt(document.getElementById('js-errors').textContent) || 0;
        const networkErrors = parseInt(document.getElementById('network-errors').textContent) || 0;
        const warnings = parseInt(document.getElementById('console-warnings').textContent) || 0;
        this.updateMetric('total-errors', jsErrors + networkErrors + warnings);
      }
      
      updateSessionTime() {
        if (this.sessionStart) {
          const duration = this.getSessionDuration();
          document.getElementById('session-duration').textContent = duration;
        }
      }
      
      getSessionDuration() {
        if (!this.sessionStart) return '00:00:00';
        
        const now = new Date();
        const diff = now - this.sessionStart;
        const hours = Math.floor(diff / 3600000);
        const minutes = Math.floor((diff % 3600000) / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
      
      log(message, type = 'info') {
        const logContainer = document.getElementById('log-entries');
        const entry = document.createElement('div');
        entry.className = `log-entry log-${type}`;
        
        const timestamp = document.createElement('div');
        timestamp.className = 'timestamp';
        timestamp.textContent = new Date().toLocaleString();
        
        const content = document.createElement('div');
        content.textContent = message;
        
        entry.appendChild(timestamp);
        entry.appendChild(content);
        
        logContainer.insertBefore(entry, logContainer.firstChild);
        
        // 保持最多100条日志
        const entries = logContainer.querySelectorAll('.log-entry');
        if (entries.length > 100) {
          entries[entries.length - 1].remove();
        }
      }
      
      showAlert(message, type) {
        const alert = document.getElementById('alert');
        alert.textContent = message;
        alert.className = `alert alert-${type} show`;
        
        setTimeout(() => {
          alert.className = alert.className.replace(' show', '');
        }, 3000);
      }
      
      getRandomTestName() {
        const tests = [
          '活动列表加载',
          '用户登录验证',
          '搜索功能',
          '页面响应性',
          '图片加载',
          'API接口调用',
          '表单提交',
          '路由导航',
          '错误处理',
          '性能指标'
        ];
        return tests[Math.floor(Math.random() * tests.length)];
      }
    }
    
    // 初始化面板
    const dashboard = new MonitoringDashboard();
    
    // 全局函数供按钮调用
    function startMonitoring() {
      dashboard.startMonitoring();
    }
    
    function pauseMonitoring() {
      dashboard.pauseMonitoring();
    }
    
    function clearLogs() {
      dashboard.clearLogs();
    }
    
    function exportData() {
      dashboard.exportData();
    }
    
    function runTests() {
      dashboard.runTests();
    }
    
    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function() {
      dashboard.log('🎭 PomeloX 监控面板已加载完成', 'success');
      dashboard.log('💡 点击 "开始监控" 按钮启动实时监控', 'info');
      dashboard.log('🧪 点击 "运行测试" 按钮执行自动化测试', 'info');
    });
  </script>
</body>
</html>