<!DOCTYPE html>
<html>
<head>
    <title>MD5 Activity Code Decoder Test</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; margin: 20px; }
        .test { padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8f9fa; }
        .success { background: #d4edda; color: #155724; }
        .failed { background: #f8d7da; color: #721c24; }
        .input { margin: 10px 0; }
        input { padding: 8px; width: 400px; font-family: monospace; }
        button { padding: 8px 16px; margin-left: 10px; }
    </style>
</head>
<body>
    <h2>ğŸ” MD5 Activity Code Decoder Test</h2>
    
    <div class="input">
        <input type="text" id="hashInput" placeholder="è¾“å…¥32ä½MD5å“ˆå¸Œå€¼" value="487f7b22f68312d2c1bbc93b1aea445b">
        <button onclick="testDecode()">ğŸ” æµ‹è¯•ç ´è§£</button>
        <button onclick="testGenerate()">ğŸ”§ ç”Ÿæˆæµ‹è¯•å“ˆå¸Œ</button>
    </div>
    
    <div id="result" class="test">ç­‰å¾…æµ‹è¯•...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // é¢„è®¡ç®—å“ˆå¸Œè¡¨
        const precomputedHashes = {};
        
        // åˆå§‹åŒ–é¢„è®¡ç®—å“ˆå¸Œè¡¨
        function initPrecomputedHashes() {
            console.log('ğŸ”§ åˆå§‹åŒ–é¢„è®¡ç®—å“ˆå¸Œè¡¨...');
            
            // é¢„è®¡ç®—1-200çš„æ´»åŠ¨ID
            for (let i = 1; i <= 200; i++) {
                const hash = CryptoJS.MD5(i.toString()).toString();
                precomputedHashes[hash] = i;
            }
            
            // é¢„è®¡ç®—å¸¸è§å‰ç¼€æ ¼å¼
            const prefixes = ['UCI_', 'activity_', 'event_', 'pomelo_', 'ACT_'];
            prefixes.forEach(prefix => {
                for (let i = 1; i <= 50; i++) {
                    const text = prefix + i;
                    const hash = CryptoJS.MD5(text).toString();
                    precomputedHashes[hash] = i;
                }
            });
            
            console.log('âœ… é¢„è®¡ç®—å“ˆå¸Œè¡¨åˆå§‹åŒ–å®Œæˆï¼Œæ¡ç›®:', Object.keys(precomputedHashes).length);
        }

        function decodeActivityHash(hash) {
            const startTime = Date.now();
            
            console.log('ğŸ” å¼€å§‹ç ´è§£å“ˆå¸Œ:', hash);
            
            // éªŒè¯å“ˆå¸Œæ ¼å¼
            if (!/^[a-f0-9]{32}$/.test(hash)) {
                return { success: false, error: 'ä¸æ˜¯32ä½MD5æ ¼å¼' };
            }
            
            // åˆå§‹åŒ–é¢„è®¡ç®—è¡¨
            if (Object.keys(precomputedHashes).length === 0) {
                initPrecomputedHashes();
            }
            
            // å…ˆæŸ¥è¯¢é¢„è®¡ç®—è¡¨
            if (precomputedHashes[hash]) {
                const result = {
                    success: true,
                    activityId: precomputedHashes[hash],
                    originalText: precomputedHashes[hash].toString(),
                    attempts: 1,
                    timeMs: Date.now() - startTime
                };
                console.log('âš¡ é¢„è®¡ç®—è¡¨å‘½ä¸­:', result);
                return result;
            }
            
            let attempts = 0;
            
            // ç­–ç•¥1: çº¯æ•°å­—ID (1-1000)
            console.log('ğŸ”¢ å°è¯•çº¯æ•°å­—ID...');
            for (let i = 1; i <= 1000; i++) {
                attempts++;
                const testHash = CryptoJS.MD5(i.toString()).toString();
                if (testHash === hash) {
                    const result = {
                        success: true,
                        activityId: i,
                        originalText: i.toString(),
                        attempts,
                        timeMs: Date.now() - startTime
                    };
                    console.log('ğŸ¯ ç ´è§£æˆåŠŸï¼ˆçº¯æ•°å­—ï¼‰:', result);
                    return result;
                }
            }
            
            // ç­–ç•¥2: UCIå‰ç¼€æ ¼å¼
            console.log('ğŸ« å°è¯•UCIå‰ç¼€æ ¼å¼...');
            for (let i = 1; i <= 100; i++) {
                attempts++;
                const text = `UCI_${i}`;
                const testHash = CryptoJS.MD5(text).toString();
                if (testHash === hash) {
                    const result = {
                        success: true,
                        activityId: i,
                        originalText: text,
                        attempts,
                        timeMs: Date.now() - startTime
                    };
                    console.log('ğŸ¯ ç ´è§£æˆåŠŸï¼ˆUCIæ ¼å¼ï¼‰:', result);
                    return result;
                }
            }
            
            return {
                success: false,
                attempts,
                timeMs: Date.now() - startTime
            };
        }

        function testDecode() {
            const hash = document.getElementById('hashInput').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!hash) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥MD5å“ˆå¸Œå€¼';
                resultDiv.className = 'test failed';
                return;
            }
            
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨ç ´è§£ï¼Œè¯·ç¨å€™...';
            resultDiv.className = 'test';
            
            // å»¶è¿Ÿæ‰§è¡Œä»¥æ˜¾ç¤ºè¿›åº¦
            setTimeout(() => {
                const result = decodeActivityHash(hash);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <strong>âœ… ç ´è§£æˆåŠŸ!</strong><br><br>
                        <strong>åŸå§‹å†…å®¹:</strong> ${result.originalText}<br>
                        <strong>æ´»åŠ¨ID:</strong> ${result.activityId}<br>
                        <strong>å°è¯•æ¬¡æ•°:</strong> ${result.attempts}<br>
                        <strong>è€—æ—¶:</strong> ${result.timeMs}ms<br>
                        <br>
                        ğŸ¯ ç°åœ¨å¯ä»¥ç”¨æ´»åŠ¨ID ${result.activityId} è°ƒç”¨ç­¾åˆ°API!
                    `;
                    resultDiv.className = 'test success';
                } else {
                    resultDiv.innerHTML = `
                        <strong>âŒ ç ´è§£å¤±è´¥</strong><br><br>
                        <strong>å°è¯•æ¬¡æ•°:</strong> ${result.attempts || 'N/A'}<br>
                        <strong>è€—æ—¶:</strong> ${result.timeMs || 'N/A'}ms<br>
                        <strong>é”™è¯¯:</strong> ${result.error || 'åœ¨å¸¸è§æ ¼å¼ä¸­æœªæ‰¾åˆ°åŒ¹é…'}
                    `;
                    resultDiv.className = 'test failed';
                }
            }, 100);
        }

        function testGenerate() {
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = 'ğŸ”§ ç”Ÿæˆæµ‹è¯•å“ˆå¸Œå€¼...';
            resultDiv.className = 'test';
            
            setTimeout(() => {
                const examples = [];
                
                // ç”Ÿæˆä¸€äº›ç¤ºä¾‹
                for (let i = 1; i <= 5; i++) {
                    const hash = CryptoJS.MD5(i.toString()).toString();
                    examples.push(`ID ${i}: ${hash}`);
                }
                
                examples.push(`UCI_1: ${CryptoJS.MD5('UCI_1').toString()}`);
                examples.push(`activity_20: ${CryptoJS.MD5('activity_20').toString()}`);
                
                resultDiv.innerHTML = `
                    <strong>ğŸ”§ ç¤ºä¾‹MD5å“ˆå¸Œå€¼:</strong><br><br>
                    ${examples.join('<br>')}
                    <br><br>
                    ç‚¹å‡»ä»»æ„å“ˆå¸Œå€¼æµ‹è¯•ç ´è§£åŠŸèƒ½
                `;
                resultDiv.className = 'test';
            }, 100);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            console.log('ğŸš€ MD5è§£ç å™¨æµ‹è¯•é¡µé¢å·²åŠ è½½');
            // è‡ªåŠ¨æµ‹è¯•ä¸€ä¸‹é¢„è®¾çš„å“ˆå¸Œ
            // testDecode();
        };
    </script>
</body>
</html>