<!DOCTYPE html>
<html>
<head>
    <title>Direct QR Test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial; margin: 20px; }
        video { width: 100%; max-width: 400px; border: 2px solid blue; }
        .result { margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border: 2px solid green; }
    </style>
</head>
<body>
    <h2>ğŸ” Direct QR Scanner Test</h2>
    <div id="status">æ­£åœ¨åˆå§‹åŒ–...</div>
    <video id="video" autoplay playsinline muted></video>
    <div id="result" class="result">ç­‰å¾…æ‰«æ...</div>

    <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
    <script>
        const video = document.getElementById('video');
        const status = document.getElementById('status');
        const result = document.getElementById('result');

        console.log('ğŸš€ Direct QR Test: å¼€å§‹');

        async function init() {
            try {
                status.textContent = 'å¯åŠ¨æ‘„åƒå¤´...';
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'environment',
                        width: 640,
                        height: 480
                    }
                });
                
                video.srcObject = stream;
                await video.play();
                
                status.textContent = 'åˆ›å»ºQRæ‰«æå™¨...';
                console.log('ğŸ“¹ æ‘„åƒå¤´OKï¼Œåˆ›å»ºæ‰«æå™¨');
                
                // ç®€å•çš„QRæ‰«æå™¨
                const scanner = new QrScanner(
                    video,
                    (qrResult) => {
                        console.log('ğŸ¯ QRæ‰«ææˆåŠŸ!', qrResult);
                        const data = typeof qrResult === 'string' ? qrResult : qrResult.data;
                        result.className = 'result success';
                        result.innerHTML = `
                            <strong>âœ… æ‰«ææˆåŠŸ!</strong><br>
                            å†…å®¹: ${data}<br>
                            æ—¶é—´: ${new Date().toLocaleTimeString()}
                        `;
                    }
                );
                
                await scanner.start();
                status.textContent = 'âœ… æ‰«æå™¨å·²å¯åŠ¨ï¼Œè¯·æ‰«æQRç ';
                console.log('âœ… QRæ‰«æå™¨å¯åŠ¨å®Œæˆ');
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
                status.textContent = 'âŒ å¤±è´¥: ' + error.message;
                result.innerHTML = 'é”™è¯¯: ' + error.message;
            }
        }

        init();
    </script>
</body>
</html>