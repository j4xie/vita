# 志愿者功能边缘测试计划 (Volunteer Feature Edge Testing Plan)

**测试版本：** v1.0.x
**测试日期：** 2025年9月
**测试环境：** 测试环境 (http://106.14.165.234:8085) + 生产环境 (https://www.vitaglobal.icu)
**测试设备：** iOS (主要) / Android (次要)

---

## 📋 测试准备

### 测试账号要求
- **管理员账号** (`manage` 权限) - 可以为他人签到/签退
- **内部员工账号** (`staff` 权限) - 只能为自己签到/签退
- **普通用户账号** (`common` 权限) - 无志愿者功能权限

### 测试数据准备
- 至少2个不同学校的用户
- 至少3条历史志愿者记录
- 已知的API限制：`/app/hour/lastRecordList` 可能返回500错误

---

## 🧪 测试模块

## 1️⃣ 签到流程测试 (Check-In Flow)

### 1.1 正常签到流程

#### **测试用例 TC-CI-001: 标准签到操作**
**前置条件：**
- 用户未签到（无活跃签到记录）
- 网络正常
- 已登录staff或manage权限账号

**测试步骤：**
1. 进入 `志愿者主页` (VolunteerHomeScreen)
2. 点击 **签到** 按钮
3. 观察签到动画和反馈
4. 等待3秒后刷新页面

**预期结果：**
- ✅ 签到按钮立即显示loading状态
- ✅ iOS设备触发触觉反馈 (Haptics.notificationAsync)
- ✅ 显示成功提示：`志愿者签到成功`
- ✅ 按钮文字变为 `签退`
- ✅ 显示实时工作时长（从0分钟开始递增）
- ✅ 后端记录：type=1, startTime为当前时间, endTime=null

**边缘情况：**
- 签到时网络突然中断 → 应显示 `网络错误，请重试`
- 重复点击签到按钮 → 应防抖，只发送一次请求
- 签到成功后立即返回上一页 → 再次进入时应显示正确的签到状态

---

#### **测试用例 TC-CI-002: 已签到状态下尝试再次签到**
**前置条件：**
- 用户已签到（存在活跃签到记录，endTime=null）

**测试步骤：**
1. 进入志愿者主页
2. 观察按钮状态
3. 尝试点击签到按钮（如果可点击）

**预期结果：**
- ✅ 签到按钮显示为 `签退` (不是签到)
- ✅ 如果通过其他入口触发签到，应弹窗提示：`用户已签到`
- ✅ 不会创建重复的签到记录

---

### 1.2 快捷操作签到 (Quick Action Modal)

#### **测试用例 TC-CI-003: 管理员为其他用户签到**
**前置条件：**
- 使用 `manage` 权限账号登录
- 目标用户未签到

**测试步骤：**
1. 扫描目标用户二维码 或 搜索目标用户
2. 弹出 `VolunteerQuickActionModal`
3. 点击 **签到** 按钮
4. 确认签到成功提示

**预期结果：**
- ✅ Modal显示目标用户信息（姓名、学号）
- ✅ 显示 `签到` 按钮（绿色）
- ✅ 签到成功后显示确认对话框：`为 [目标用户名] 签到成功`
- ✅ 自动关闭Modal并返回
- ✅ 后端记录：userId=目标用户ID, operatorId=当前管理员ID

**边缘情况：**
- 目标用户已签到 → 应显示 `签退` 按钮而非签到
- 管理员离线 → 应显示网络错误提示
- 签到成功后立即为同一用户再次扫码 → 应显示签退按钮

---

#### **测试用例 TC-CI-004: 普通员工尝试为他人签到**
**前置条件：**
- 使用 `staff` 权限账号登录
- 尝试扫描其他用户二维码

**测试步骤：**
1. 扫描其他用户二维码
2. 观察权限检查结果

**预期结果：**
- ✅ 如果是staff账号扫描自己：显示快捷操作Modal
- ✅ 如果是staff账号扫描他人：应提示 `权限不足，无法为他人签到`
- ✅ 不会触发签到API调用

---

### 1.3 签到状态恢复

#### **测试用例 TC-CI-005: 签到后关闭应用再打开**
**前置条件：**
- 用户已签到
- 工作时长已经5分钟

**测试步骤：**
1. 完全关闭应用（杀进程）
2. 重新打开应用
3. 进入志愿者主页

**预期结果：**
- ✅ 按钮显示为 `签退`
- ✅ 工作时长显示正确（5分钟 + 离开时间）
- ✅ 实时时长继续递增
- ✅ 本地缓存与后端状态一致

**边缘情况：**
- 关闭应用超过12小时 → 应触发12小时自动签退逻辑
- 网络离线时打开应用 → 应尝试从本地缓存恢复状态

---

## 2️⃣ 签退流程测试 (Check-Out Flow)

### 2.1 正常签退流程

#### **测试用例 TC-CO-001: 标准签退操作**
**前置条件：**
- 用户已签到（活跃签到记录存在）
- 工作时长至少1分钟

**测试步骤：**
1. 在志愿者主页点击 **签退** 按钮
2. 进入 `VolunteerCheckOutScreen`
3. 观察界面显示的信息
4. (可选) 填写工作描述
5. 点击 **提交签退** 按钮

**预期结果：**
- ✅ 显示签到时间：`签到: 2025-09-29 14:30`
- ✅ 显示实时工作时长：`工作时长: 1小时23分钟` (实时更新)
- ✅ 可以选择快捷描述选项（如："接待新生", "活动准备"）
- ✅ 可以手动输入自定义描述（最多200字符）
- ✅ 签退成功后显示确认对话框
- ✅ 返回志愿者主页，按钮恢复为 `签到`
- ✅ 后端记录：endTime为当前时间, description已保存

**边缘情况：**
- 填写超长描述（>200字符） → 应截断或提示字符限制
- 签退时网络中断 → 应保存到待处理队列，下次启动时重试
- 签退过程中按返回键 → 应弹出确认对话框：`确定取消签退吗？`

---

#### **测试用例 TC-CO-002: 未签到状态下尝试签退**
**前置条件：**
- 用户未签到（无活跃记录）

**测试步骤：**
1. 尝试通过任何方式触发签退操作

**预期结果：**
- ✅ 签退按钮应该不可见或禁用
- ✅ 如果通过异常路径触发，应提示：`未检测到活跃签到记录`

---

### 2.2 自动签退功能

#### **测试用例 TC-CO-003: 应用退出自动签退（5秒延迟）**
**前置条件：**
- 用户已签到
- 自动签退功能已启用（默认启用）

**测试步骤：**
1. 用户已签到状态
2. 按Home键将应用切换到后台
3. 等待 **5秒**（配置的延迟时间）
4. 重新打开应用
5. 进入志愿者主页检查状态

**预期结果：**
- ✅ 5秒后自动执行签退
- ✅ 签退描述为：`【自动签退】应用退出时自动签退`
- ✅ 重新打开应用时显示 `签到` 按钮
- ✅ 工作时长正确记录到后台前的最后一刻

**边缘情况：**
- 4秒内重新激活应用 → 应取消自动签退定时器
- 后台时网络中断 → 签退失败，下次启动时重试
- 连续快速切换前后台 → 应只保留最后一次定时器

---

#### **测试用例 TC-CO-004: 12小时超时自动签退**
**前置条件：**
- 用户签到时间超过12小时（需要修改系统时间或等待）

**测试步骤：**
1. 用户签到后
2. 修改设备时间至12小时后 **或** 实际等待12小时
3. 重新打开应用 或 触发超时检查
4. 进入志愿者主页

**预期结果：**
- ✅ 自动执行签退
- ✅ 签退时间为：签到时间 + 12小时
- ✅ 签退描述为：`【自动签退】超时签到，系统自动处理（原签到时间：XXX，实际工作：13.5小时）`
- ✅ 工作时长被限制为 **12小时**
- ✅ 状态恢复为未签到

**边缘情况：**
- 用户在11小时59分手动签退 → 应正常签退，不触发自动签退
- 超时签退失败（网络问题） → 应保存到pending队列，下次启动重试

---

### 2.3 快捷操作签退

#### **测试用例 TC-CO-005: 管理员为其他用户签退**
**前置条件：**
- 使用 `manage` 权限账号
- 目标用户已签到

**测试步骤：**
1. 扫描已签到用户的二维码
2. 在 `VolunteerQuickActionModal` 中点击 **签退**
3. 确认签退成功

**预期结果：**
- ✅ Modal显示 `签退` 按钮（红色）
- ✅ 显示目标用户的当前工作时长
- ✅ 签退成功后显示：`为 [目标用户名] 签退成功`
- ✅ 后端记录：operatorId=当前管理员ID

**边缘情况：**
- 目标用户在签退过程中自己也触发了签退 → 应检测到冲突并提示
- 管理员网络中断 → 应显示签退失败，提示稍后重试

---

## 3️⃣ 补录工时测试 (Time Entry Modal)

### 3.1 正常补录流程

#### **测试用例 TC-TE-001: 补录今天的工时**
**前置条件：**
- 用户有补录工时的权限
- 目标日期：今天

**测试步骤：**
1. 在志愿者主页点击 **补录工时** 按钮
2. 弹出 `VolunteerTimeEntryModal`
3. 选择日期：今天
4. 选择开始时间：14:00
5. 选择结束时间：16:30
6. 填写描述："帮助整理活动物资"
7. 点击 **提交**

**预期结果：**
- ✅ 日期选择器显示当前日期
- ✅ 时间选择器显示HH:MM格式（24小时制）
- ✅ 自动计算工作时长：`2小时30分钟`
- ✅ 提交成功后显示确认提示
- ✅ 自动关闭Modal并刷新志愿者记录列表
- ✅ 后端记录：type=3（补录类型）, startTime和endTime正确

**边缘情况：**
- 结束时间早于开始时间 → 应提示：`结束时间必须晚于开始时间`
- 时间范围超过24小时 → 应提示：`单次工作时长不能超过24小时`
- 未填写描述 → 应允许提交（描述为可选）

---

#### **测试用例 TC-TE-002: 补录历史工时（过去7天内）**
**前置条件：**
- 用户有补录权限
- 目标日期：7天前

**测试步骤：**
1. 打开补录工时Modal
2. 选择日期：7天前的某一天
3. 选择时间：10:00 - 15:00
4. 提交

**预期结果：**
- ✅ 可以正常选择过去30天内的日期
- ✅ 时间自动同步到选择的日期
- ✅ 提交成功，记录显示在历史列表中

**边缘情况：**
- 选择超过30天的日期 → 应提示：`只能补录30天内的工时`
- 选择未来日期 → 应提示：`不能补录未来的工时`

---

#### **测试用例 TC-TE-003: 手动输入时间格式**
**前置条件：**
- 启用手动输入模式（如果支持）

**测试步骤：**
1. 打开补录工时Modal
2. 点击时间输入框旁的 `手动输入` 按钮
3. 输入格式：`14:30`
4. 切换到另一个时间输入框
5. 输入不合法格式：`25:70`

**预期结果：**
- ✅ 合法格式自动转换为时间对象
- ✅ 不合法格式显示错误提示：`时间格式不正确，请使用 HH:MM 格式`
- ✅ 不合法输入后无法提交

**支持的格式：**
- `14:30` → 14:30
- `9:5` → 09:05
- `2:45 PM` → 14:45 (如果支持12小时制)

---

### 3.2 补录时间验证

#### **测试用例 TC-TE-004: 时间冲突检测**
**前置条件：**
- 用户已有一条记录：2025-09-29 10:00-12:00

**测试步骤：**
1. 尝试补录重叠时间段：2025-09-29 11:00-13:00
2. 提交

**预期结果：**
- ⚠️ **当前系统行为：** 可能允许提交（后端未做冲突检测）
- ✅ **理想行为：** 应提示：`该时间段与已有记录冲突`

**边缘情况：**
- 补录时间与当前活跃签到冲突 → 应提示并禁止提交
- 补录多个不冲突的时间段 → 应全部成功

---

#### **测试用例 TC-TE-005: 跨天工作时段**
**前置条件：**
- 需要补录跨天的工作时间

**测试步骤：**
1. 选择日期：2025-09-29
2. 开始时间：23:00
3. 结束时间：01:00（次日）
4. 提交

**预期结果：**
- ⚠️ **当前系统行为：** 可能将结束时间视为同一天的01:00（导致负时长）
- ✅ **理想行为：** 应自动处理跨天情况，或提示用户分两次补录

**建议修复：** 在Time Entry Modal中添加跨天提示和日期调整逻辑

---

### 3.3 补录权限控制

#### **测试用例 TC-TE-006: 普通用户补录自己的工时**
**前置条件：**
- 使用 `staff` 权限账号
- 只能补录自己的工时

**测试步骤：**
1. 打开补录工时Modal
2. 观察是否有用户选择器
3. 提交补录

**预期结果：**
- ✅ 不显示用户选择器（自动使用当前用户）
- ✅ targetUserId = 当前用户ID
- ✅ 提交成功

---

#### **测试用例 TC-TE-007: 管理员为他人补录工时**
**前置条件：**
- 使用 `manage` 权限账号
- 有用户选择功能

**测试步骤：**
1. 打开补录工时Modal
2. 选择目标用户：其他staff用户
3. 选择时间段并提交

**预期结果：**
- ✅ 显示用户选择器
- ✅ 可以搜索并选择其他用户
- ✅ 提交成功，记录属于目标用户
- ✅ 后端记录：userId=目标用户ID, operatorId=当前管理员ID

---

## 4️⃣ 时间计算与显示

### 4.1 时间格式测试

#### **测试用例 TC-TIME-001: 不同时区时间显示**
**前置条件：**
- 用户在不同时区使用应用

**测试步骤：**
1. 设备时区：美国东部时间 (UTC-5)
2. 签到时间：2025-09-29 10:00 (EST)
3. 切换设备时区到：太平洋时间 (UTC-8)
4. 观察显示的签到时间

**预期结果：**
- ✅ 签到时间应保持一致，显示本地时间：10:00 EST
- ✅ 工作时长计算正确，不受时区影响
- ✅ 使用 `timeService.formatLocalTime()` 统一处理

**已知问题：**
- 旧代码可能存在 `toISOString()` 和本地时间混用问题
- 应统一使用 `UnifiedTimeService`

---

#### **测试用例 TC-TIME-002: 实时工作时长更新**
**前置条件：**
- 用户已签到

**测试步骤：**
1. 观察志愿者主页的工作时长显示
2. 等待61秒
3. 观察时长变化

**预期结果：**
- ✅ 每秒更新一次：`0小时1分钟` → `0小时2分钟`
- ✅ 页面离开后再返回，时长继续正确累加
- ✅ 应用切换到后台再激活，时长无跳跃

**边缘情况：**
- 设备休眠后唤醒 → 时长应包含休眠时间
- 时钟调整（夏令时切换） → 应正确处理

---

### 4.2 时长格式化

#### **测试用例 TC-TIME-003: 不同时长格式显示**
**测试数据：**
- 1分钟 → `1分钟`
- 59分钟 → `59分钟`
- 60分钟 → `1小时0分钟`
- 90分钟 → `1小时30分钟`
- 125分钟 → `2小时5分钟`
- 720分钟 → `12小时0分钟`

**预期结果：**
- ✅ 所有格式化正确，使用 `timeService.formatDuration()`
- ✅ 中英文都正确显示：`1 hour 30 minutes` / `1小时30分钟`

---

## 5️⃣ 状态同步测试

### 5.1 本地缓存与后端同步

#### **测试用例 TC-SYNC-001: 签到后立即刷新**
**前置条件：**
- 用户刚完成签到

**测试步骤：**
1. 签到成功
2. 下拉刷新页面
3. 观察状态是否正确

**预期结果：**
- ✅ 下拉刷新后依然显示签到状态
- ✅ 工作时长继续累加
- ✅ 本地缓存与后端数据一致

**边缘情况：**
- 刷新时后端延迟返回 → 应显示loading状态，不闪烁
- 刷新失败 → 应保持本地缓存状态，显示错误提示

---

#### **测试用例 TC-SYNC-002: 多设备同时操作**
**前置条件：**
- 同一账号同时登录两台设备

**测试步骤：**
1. 设备A：签到
2. 设备B：刷新页面
3. 设备B：尝试签退
4. 设备A：刷新页面

**预期结果：**
- ✅ 设备B刷新后显示已签到状态
- ✅ 设备B可以正常签退
- ✅ 设备A刷新后显示已签退状态
- ✅ 不会出现状态不一致

**边缘情况：**
- 两台设备同时签退 → 第二台应提示已签退
- 一台设备离线后签退 → 上线后应正确同步

---

### 5.2 API缓存管理

#### **测试用例 TC-SYNC-003: 签到/签退后缓存失效**
**前置条件：**
- 应用使用了 `apiCache` 缓存志愿者记录

**测试步骤：**
1. 查看志愿者记录列表（触发缓存）
2. 进行签到操作
3. 返回记录列表
4. 观察是否显示最新签到记录

**预期结果：**
- ✅ 签到后自动清除相关缓存
- ✅ 记录列表立即显示最新数据
- ✅ 使用 `apiCache.invalidate('volunteer')` 清除缓存

**需要清除缓存的操作：**
- 签到
- 签退
- 补录工时
- 删除记录（如果支持）

---

## 6️⃣ 错误处理与恢复

### 6.1 网络错误

#### **测试用例 TC-ERROR-001: 签到时网络中断**
**测试步骤：**
1. 开启飞行模式
2. 尝试签到
3. 观察错误提示
4. 关闭飞行模式
5. 重试签到

**预期结果：**
- ✅ 立即显示错误提示：`网络连接失败，请检查网络设置`
- ✅ 提供 `重试` 按钮
- ✅ 重试成功后正常签到
- ✅ 不会创建重复记录

---

#### **测试用例 TC-ERROR-002: 签退时网络超时**
**测试步骤：**
1. 模拟慢速网络（使用Network Link Conditioner）
2. 签退
3. 请求超过60秒
4. 观察超时处理

**预期结果：**
- ✅ 显示loading状态最多60秒
- ✅ 超时后提示：`网络请求超时，请重试`
- ✅ 签退数据保存到待处理队列
- ✅ 下次启动应用时自动重试

---

### 6.2 后端API错误

#### **测试用例 TC-ERROR-003: 后端返回500错误**
**前置条件：**
- 已知 `/app/hour/lastRecordList` 接口存在SQL错误

**测试步骤：**
1. 触发调用 `lastRecordList` 的操作
2. 观察错误处理
3. 检查是否有备用方案

**预期结果：**
- ✅ 不显示技术错误信息给用户
- ✅ 友好提示：`志愿者状态暂时无法获取`
- ✅ 自动切换到备用接口 `/app/hour/recordList`
- ✅ 使用本地缓存保持状态

**回归测试：**
- 后端修复后，验证主接口可以正常使用
- 备用逻辑不影响正常流程

---

#### **测试用例 TC-ERROR-004: Token过期处理**
**测试步骤：**
1. 修改本地token为过期token
2. 尝试签到操作
3. 观察处理逻辑

**预期结果：**
- ✅ 自动检测到401错误
- ✅ 清除本地token
- ✅ 跳转到登录页面
- ✅ 提示：`登录已过期，请重新登录`

---

### 6.3 数据不一致恢复

#### **测试用例 TC-ERROR-005: 本地显示已签到但后端无记录**
**测试步骤：**
1. 签到成功（本地缓存记录）
2. 手动删除后端签到记录（模拟数据丢失）
3. 刷新页面
4. 观察状态恢复

**预期结果：**
- ✅ 检测到本地与后端不一致
- ✅ 以后端数据为准，清除本地缓存
- ✅ 按钮恢复为 `签到` 状态
- ✅ 提示用户：`状态已同步`

---

## 7️⃣ 权限与安全测试

### 7.1 权限边界测试

#### **测试用例 TC-PERM-001: 普通用户尝试访问志愿者功能**
**前置条件：**
- 使用 `common` 权限账号

**测试步骤：**
1. 尝试进入志愿者主页
2. 观察权限检查

**预期结果：**
- ✅ 页面显示：`您没有志愿者功能权限`
- ✅ 签到/签退按钮不可见
- ✅ 无法通过API直接调用签到接口

---

#### **测试用例 TC-PERM-002: 伪造请求测试**
**测试步骤：**
1. 拦截签到API请求
2. 修改userId为其他用户ID
3. 发送伪造请求

**预期结果：**
- ✅ 后端验证token与userId匹配
- ✅ 返回403错误：`权限不足`
- ✅ 前端显示错误提示

---

### 7.2 数据隔离测试

#### **测试用例 TC-PERM-003: 用户只能看到自己的记录**
**前置条件：**
- 使用 `staff` 权限账号

**测试步骤：**
1. 查看志愿者历史记录
2. 尝试修改API参数获取其他用户记录

**预期结果：**
- ✅ 历史记录只显示当前用户数据
- ✅ 后端强制过滤userId参数
- ✅ 无法通过修改参数查看他人记录

---

## 8️⃣ 性能与用户体验测试

### 8.1 页面加载性能

#### **测试用例 TC-PERF-001: 志愿者主页加载时间**
**测试步骤：**
1. 清除应用缓存
2. 进入志愿者主页
3. 测量加载时间

**预期结果：**
- ✅ 首次加载 < 2秒
- ✅ 使用缓存后加载 < 500ms
- ✅ 显示骨架屏而非空白页

---

#### **测试用例 TC-PERF-002: 实时时长更新CPU占用**
**测试步骤：**
1. 签到后停留在志愿者主页
2. 观察30分钟
3. 监控CPU和内存占用

**预期结果：**
- ✅ CPU占用 < 5%
- ✅ 内存无明显增长（无内存泄漏）
- ✅ 使用 `useCallback` 和 `useMemo` 优化渲染

---

### 8.2 动画与交互

#### **测试用例 TC-UX-001: 签到按钮反馈**
**测试步骤：**
1. 点击签到按钮
2. 观察视觉和触觉反馈

**预期结果：**
- ✅ iOS设备触发触觉反馈
- ✅ 按钮有按压动画（scale缩小）
- ✅ Loading动画流畅（60fps）
- ✅ 成功后显示绿色勾选动画

---

#### **测试用例 TC-UX-002: 时间选择器易用性**
**测试步骤：**
1. 打开补录工时Modal
2. 使用iOS时间选择器
3. 快速滚动选择时间

**预期结果：**
- ✅ iOS原生时间选择器体验
- ✅ 滚动流畅，无卡顿
- ✅ 选择后立即显示在输入框

---

## 9️⃣ 国际化与本地化

### 9.1 语言切换测试

#### **测试用例 TC-I18N-001: 中英文切换**
**测试步骤：**
1. 当前语言：中文
2. 签到状态：已签到
3. 切换到英文
4. 观察界面文本

**预期结果：**
- ✅ 所有文本立即切换到英文
- ✅ 签到按钮：`签退` → `Check Out`
- ✅ 时长显示：`1小时30分钟` → `1 hour 30 minutes`
- ✅ 无hardcoded中文残留

**需要检查的文本：**
- 按钮文字
- 提示消息
- 错误信息
- 时间格式
- 日期格式

---

#### **测试用例 TC-I18N-002: 翻译键缺失处理**
**测试步骤：**
1. 模拟翻译键不存在的情况
2. 观察显示内容

**预期结果：**
- ✅ 显示fallback文本（英文）
- ✅ 不显示翻译键名称（如 `volunteer.checkin.title`）
- ✅ 控制台警告缺失的翻译键

---

## 🔟 集成测试场景

### 10.1 完整工作流程

#### **测试用例 TC-INT-001: 完整志愿者工作日**
**场景描述：** 模拟一名志愿者的完整工作流程

**测试步骤：**
1. **上午9:00** - 到达办公室，签到
2. **上午9:05** - 应用切换到后台（查看其他应用）
3. **上午9:10** - 重新打开应用，确认签到状态正常
4. **中午12:00** - 签退（午休）
5. **下午14:00** - 再次签到
6. **下午18:00** - 签退
7. **晚上20:00** - 补录忘记的工时（上午10:30-11:00）
8. **查看历史记录** - 验证所有记录正确

**预期结果：**
- ✅ 所有操作成功
- ✅ 工作时长计算正确：上午3小时 + 下午4小时 + 补录30分钟 = 7.5小时
- ✅ 历史记录显示3条记录
- ✅ 无重复或丢失记录

---

#### **测试用例 TC-INT-002: 管理员批量操作**
**场景描述：** 管理员在活动现场为多名志愿者签到/签退

**测试步骤：**
1. 活动开始前，为10名志愿者依次签到（扫码）
2. 活动进行中，部分志愿者离开，为其签退
3. 活动结束后，批量为剩余志愿者签退
4. 查看所有志愿者的工作记录

**预期结果：**
- ✅ 所有签到/签退操作成功
- ✅ 无状态混乱或冲突
- ✅ 管理员界面性能良好（无卡顿）
- ✅ 可以快速切换不同用户操作

---

### 10.2 异常恢复场景

#### **测试用例 TC-INT-003: 应用崩溃恢复**
**测试步骤：**
1. 用户签到
2. 强制杀死应用进程（模拟崩溃）
3. 重新启动应用
4. 检查状态

**预期结果：**
- ✅ 签到状态从本地缓存恢复
- ✅ 工作时长继续累加
- ✅ 可以正常签退

---

#### **测试用例 TC-INT-004: 网络波动场景**
**测试步骤：**
1. 签到时网络良好
2. 签到后关闭WiFi，使用4G
3. 30分钟后切换回WiFi
4. 签退

**预期结果：**
- ✅ 网络切换不影响状态显示
- ✅ 签退时自动使用当前可用网络
- ✅ 工作时长计算不受影响

---

## 📊 测试报告模板

### 测试执行记录表

| 测试用例ID | 测试名称 | 执行日期 | 测试结果 | 发现问题 | 备注 |
|-----------|----------|----------|----------|----------|------|
| TC-CI-001 | 标准签到操作 | 2025-09-29 | ✅ 通过 | 无 | - |
| TC-CI-002 | 重复签到检查 | 2025-09-29 | ❌ 失败 | 未阻止重复签到 | 需要添加前端检查 |
| ... | ... | ... | ... | ... | ... |

### Bug报告格式

```markdown
**Bug ID:** BUG-VOLUNTEER-001
**严重程度:** 高/中/低
**发现日期:** 2025-09-29
**测试用例:** TC-CO-004
**问题描述:** 12小时自动签退未触发
**复现步骤:**
1. 用户签到
2. 修改系统时间至12小时后
3. 重新打开应用
4. 观察状态

**预期结果:** 自动签退并限制工作时长为12小时
**实际结果:** 状态依然显示为已签到
**根本原因:** `checkOvertimeSignin()` 未在应用启动时调用
**修复方案:** 在 `App.tsx` 中添加启动检查
**验证状态:** 待修复
```

---

## 📝 测试清单 (Checklist)

### 签到功能 ✓
- [ ] TC-CI-001: 标准签到
- [ ] TC-CI-002: 重复签到阻止
- [ ] TC-CI-003: 管理员为他人签到
- [ ] TC-CI-004: 权限检查
- [ ] TC-CI-005: 状态恢复

### 签退功能 ✓
- [ ] TC-CO-001: 标准签退
- [ ] TC-CO-002: 未签到阻止签退
- [ ] TC-CO-003: 5秒自动签退
- [ ] TC-CO-004: 12小时超时签退
- [ ] TC-CO-005: 管理员为他人签退

### 补录工时 ✓
- [ ] TC-TE-001: 补录今天工时
- [ ] TC-TE-002: 补录历史工时
- [ ] TC-TE-003: 手动输入时间
- [ ] TC-TE-004: 时间冲突检测
- [ ] TC-TE-005: 跨天时段处理
- [ ] TC-TE-006: 普通用户补录
- [ ] TC-TE-007: 管理员为他人补录

### 时间计算 ✓
- [ ] TC-TIME-001: 时区处理
- [ ] TC-TIME-002: 实时时长更新
- [ ] TC-TIME-003: 时长格式化

### 状态同步 ✓
- [ ] TC-SYNC-001: 刷新后状态一致
- [ ] TC-SYNC-002: 多设备同步
- [ ] TC-SYNC-003: 缓存失效

### 错误处理 ✓
- [ ] TC-ERROR-001: 网络中断
- [ ] TC-ERROR-002: 网络超时
- [ ] TC-ERROR-003: 后端500错误
- [ ] TC-ERROR-004: Token过期
- [ ] TC-ERROR-005: 数据不一致恢复

### 权限与安全 ✓
- [ ] TC-PERM-001: 普通用户权限
- [ ] TC-PERM-002: 伪造请求防护
- [ ] TC-PERM-003: 数据隔离

### 性能与体验 ✓
- [ ] TC-PERF-001: 页面加载性能
- [ ] TC-PERF-002: CPU占用
- [ ] TC-UX-001: 交互反馈
- [ ] TC-UX-002: 时间选择器

### 国际化 ✓
- [ ] TC-I18N-001: 中英文切换
- [ ] TC-I18N-002: 翻译缺失处理

### 集成测试 ✓
- [ ] TC-INT-001: 完整工作流程
- [ ] TC-INT-002: 管理员批量操作
- [ ] TC-INT-003: 崩溃恢复
- [ ] TC-INT-004: 网络波动

---

## 🎯 高优先级测试项

基于已知问题和关键功能，以下测试应优先执行：

1. **TC-CO-004** - 12小时超时自动签退（核心安全功能）
2. **TC-ERROR-003** - 后端500错误处理（已知问题回归）
3. **TC-SYNC-002** - 多设备状态同步（常见使用场景）
4. **TC-TIME-001** - 时区处理（国际用户关键）
5. **TC-TE-005** - 跨天时段处理（边缘情况易出错）
6. **TC-INT-001** - 完整工作流程（端到端验证）

---

## 📌 注意事项

### 测试环境设置
- **测试环境API:** `http://106.14.165.234:8085`
- **生产环境API:** `https://www.vitaglobal.icu`
- 建议先在测试环境执行所有测试，通过后再在生产环境回归

### 测试数据清理
- 每次测试后清理测试数据，避免污染生产数据
- 管理员操作应使用测试账号，不要影响真实用户

### 已知限制
- `/app/hour/lastRecordList` 接口存在SQL错误（后端待修复）
- 跨天时段补录可能需要分两次操作
- 时区处理完全依赖 `UnifiedTimeService`

---

**文档版本:** v1.0
**最后更新:** 2025-09-29
**维护者:** PomeloX测试团队