# æ´»åŠ¨åˆ—è¡¨ç©ºç™½é—®é¢˜è°ƒè¯•æŒ‡å—

## ğŸ” é—®é¢˜è¯Šæ–­å·¥å…·

æˆ‘å·²ç»ä¸ºä½ æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—å’Œè¯Šæ–­å·¥å…·ã€‚

### 1. è¿è¡Œè¯Šæ–­è„šæœ¬

```bash
node diagnose-activity-issue.js
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… æµ‹è¯•ç”Ÿäº§ç¯å¢ƒAPI (https://www.vitaglobal.icu)
- âœ… æµ‹è¯•æµ‹è¯•ç¯å¢ƒAPI (http://106.14.165.234:8085)
- âœ… æ£€æŸ¥ç¯å¢ƒé…ç½®æ–‡ä»¶
- âœ… æä¾›ä¿®å¤å»ºè®®

### 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

ç°åœ¨åº”ç”¨ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œä½ å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ï¼š

```
ğŸ” [ACTIVITY-LIST] åˆå§‹åŒ–éª¨æ¶å±å®šæ—¶å™¨
ğŸš€ [ACTIVITY-LIST] ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹åˆå§‹æ•°æ®åŠ è½½
ğŸŒ [FETCH-ACTIVITIES] ========== å¼€å§‹è·å–æ´»åŠ¨æ•°æ® ==========
```

**å¦‚ä½•æŸ¥çœ‹æ—¥å¿—:**

1. **åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹**: è¿è¡Œ `npm start` åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæ‰€æœ‰console.log
2. **åœ¨æµè§ˆå™¨DevToolsä¸­**: å¦‚æœç”¨æµè§ˆå™¨æ‰“å¼€ï¼ŒæŒ‰F12æŸ¥çœ‹Console
3. **åœ¨React Native Debugger**: ä½¿ç”¨ React Native Debugger å·¥å…·

### 3. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•

#### é—®é¢˜A: éª¨æ¶å±ä¸€ç›´æ˜¾ç¤º

**ç—‡çŠ¶**: ç•Œé¢æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ä½†ä¸€ç›´ä¸æ¶ˆå¤±

**æ—¥å¿—ç‰¹å¾**:
```
ğŸ” [ACTIVITY-LIST] åˆå§‹åŒ–éª¨æ¶å±å®šæ—¶å™¨
[æ²¡æœ‰åç»­æ—¥å¿—]
```

**è§£å†³æ–¹æ³•**:
```bash
# å®Œå…¨æ¸…ç†é¡¹ç›®ç¼“å­˜
rm -rf node_modules/.cache .expo
npm run start:cache
```

#### é—®é¢˜B: ç½‘ç»œè¯·æ±‚å¤±è´¥

**ç—‡çŠ¶**: ç•Œé¢ç©ºç™½æˆ–æ˜¾ç¤ºé”™è¯¯æç¤º

**æ—¥å¿—ç‰¹å¾**:
```
âŒ [FETCH-ACTIVITIES] ========== è·å–æ´»åŠ¨æ•°æ®å¤±è´¥ ==========
âŒ [FETCH-ACTIVITIES] é”™è¯¯è¯¦æƒ…: { name: 'NetworkError', ... }
```

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯•åˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒ: `npm run ios:dev`
3. æ£€æŸ¥APIæœåŠ¡å™¨çŠ¶æ€: `curl https://www.vitaglobal.icu/app/activity/list?pageNum=1&pageSize=10`

#### é—®é¢˜C: ç”¨æˆ·æœªç™»å½•

**ç—‡çŠ¶**: ç•Œé¢æ˜¾ç¤ºç©ºåˆ—è¡¨ä½†æ²¡æœ‰é”™è¯¯

**æ—¥å¿—ç‰¹å¾**:
```
ğŸ” [ACTIVITY-LIST] ç”¨æˆ·ä¿¡æ¯: { hasUser: false, userId: undefined }
ğŸ“‹ [FETCH-ACTIVITIES] å‡†å¤‡è·å–æ´»åŠ¨åˆ—è¡¨: { mode: 'è®¿å®¢æ¨¡å¼' }
```

**è§£å†³æ–¹æ³•**:
1. è®¿å®¢æ¨¡å¼ä¹Ÿåº”è¯¥èƒ½çœ‹åˆ°æ´»åŠ¨åˆ—è¡¨
2. å¦‚æœæƒ³è¦ä¸ªæ€§åŒ–æ•°æ®ï¼Œè¯·å…ˆç™»å½•
3. æ£€æŸ¥AsyncStorageä¸­çš„token: åœ¨ä»£ç ä¸­æ·»åŠ  `AsyncStorage.getItem('@pomelox_token').then(console.log)`

#### é—®é¢˜D: APIè¿”å›æ•°æ®ä½†ç•Œé¢ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤ºè·å–åˆ°æ•°æ®ï¼Œä½†ç•Œé¢ä»ç„¶ç©ºç™½

**æ—¥å¿—ç‰¹å¾**:
```
âœ… [FETCH-ACTIVITIES] æœ€ç»ˆçŠ¶æ€: { activitiesCount: 10, hasError: false }
å½“å‰æ´»åŠ¨æ•°æ®: 10 æ¡æ´»åŠ¨
```

**è§£å†³æ–¹æ³•**:
```bash
# è¿™å¯èƒ½æ˜¯æ¸²æŸ“é—®é¢˜ï¼Œå°è¯•å®Œå…¨é‡æ–°åŠ è½½
npm run start:cache
```

### 4. å¿«é€Ÿä¿®å¤å‘½ä»¤æ€»ç»“

```bash
# æ–¹æ³•1: æ¸…ç†ç¼“å­˜é‡å¯ (æœ€å¸¸ç”¨)
npm run start:cache

# æ–¹æ³•2: åˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒ
npm run ios:dev

# æ–¹æ³•3: åˆ‡æ¢å›ç”Ÿäº§ç¯å¢ƒ
npm run ios:prod

# æ–¹æ³•4: å®Œå…¨æ¸…ç†
rm -rf node_modules/.cache .expo
npm cache clean --force
npm start -- --clear
```

### 5. å¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œ

å¦‚æœå°è¯•äº†æ‰€æœ‰æ–¹æ³•éƒ½ä¸è¡Œï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **å®Œæ•´çš„ç»ˆç«¯æ—¥å¿—** (ä»å¯åŠ¨åˆ°å‡ºç°é—®é¢˜)
2. **ç½‘ç»œè¯·æ±‚æ—¥å¿—** (æ‰€æœ‰å¸¦ [FETCH-ACTIVITIES] çš„æ—¥å¿—)
3. **ç”¨æˆ·çŠ¶æ€** (æ—¥å¿—ä¸­çš„ "ç”¨æˆ·ä¿¡æ¯" éƒ¨åˆ†)
4. **APIæµ‹è¯•ç»“æœ** (è¿è¡Œ `node diagnose-activity-issue.js` çš„è¾“å‡º)

### 6. ä¸´æ—¶è°ƒè¯•ä»£ç 

å¦‚æœéœ€è¦æ›´æ·±å…¥çš„è°ƒè¯•ï¼Œå¯ä»¥åœ¨ `ActivityListScreen.tsx` ä¸­æ·»åŠ ï¼š

```typescript
// åœ¨ useEffect ä¸­æ·»åŠ 
useEffect(() => {
  console.log('ğŸ” DEBUG - æ‰€æœ‰çŠ¶æ€:', {
    initialLoading,
    loading,
    refreshing,
    activitiesCount: activities.length,
    hasError: !!error,
    errorMessage: error,
    user: user ? { id: user.id, userName: user.userName } : null,
  });
}, [initialLoading, loading, refreshing, activities, error, user]);
```

---

**è¯Šæ–­å·¥å…·ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-09-30